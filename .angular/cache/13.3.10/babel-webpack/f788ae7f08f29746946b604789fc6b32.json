{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.column_headers.js)\r\n * Version: 21.2.6\r\n * Build date: Tue Mar 01 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getHeight } from \"../../core/utils/size\";\nimport $ from \"../../core/renderer\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport { ColumnsView } from \"./ui.grid_core.columns_view\";\nimport messageLocalization from \"../../localization/message\";\nimport { isDefined } from \"../../core/utils/type\";\nimport { each } from \"../../core/utils/iterator\";\nimport { extend } from \"../../core/utils/extend\";\nimport { registerKeyboardAction } from \"./ui.grid_core.accessibility\";\nvar CELL_CONTENT_CLASS = \"text-content\";\nvar HEADERS_CLASS = \"headers\";\nvar NOWRAP_CLASS = \"nowrap\";\nvar ROW_CLASS_SELECTOR = \".dx-row\";\nvar HEADER_ROW_CLASS = \"dx-header-row\";\nvar COLUMN_LINES_CLASS = \"dx-column-lines\";\nvar CONTEXT_MENU_SORT_ASC_ICON = \"context-menu-sort-asc\";\nvar CONTEXT_MENU_SORT_DESC_ICON = \"context-menu-sort-desc\";\nvar CONTEXT_MENU_SORT_NONE_ICON = \"context-menu-sort-none\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nvar VISIBILITY_HIDDEN_CLASS = \"dx-visibility-hidden\";\nvar TEXT_CONTENT_ALIGNMENT_CLASS_PREFIX = \"dx-text-content-alignment-\";\nvar SORT_INDICATOR_CLASS = \"dx-sort-indicator\";\nvar SORT_INDEX_INDICATOR_CLASS = \"dx-sort-index-indicator\";\nvar HEADER_FILTER_CLASS_SELECTOR = \".dx-header-filter\";\nvar HEADER_FILTER_INDICATOR_CLASS = \"dx-header-filter-indicator\";\nvar MULTI_ROW_HEADER_CLASS = \"dx-header-multi-row\";\nexport var columnHeadersModule = {\n  defaultOptions: function defaultOptions() {\n    return {\n      showColumnHeaders: true,\n      cellHintEnabled: true\n    };\n  },\n  views: {\n    columnHeadersView: ColumnsView.inherit(function () {\n      var createCellContent = function createCellContent(that, $cell, options) {\n        var $cellContent = $(\"<div>\").addClass(that.addWidgetPrefix(CELL_CONTENT_CLASS));\n        that.setAria(\"role\", \"presentation\", $cellContent);\n        addCssClassesToCellContent(that, $cell, options.column, $cellContent);\n        var showColumnLines = that.option(\"showColumnLines\");\n        var contentAlignment = that.getController(\"columns\").getHeaderContentAlignment(options.column.alignment);\n        return $cellContent[showColumnLines || \"right\" === contentAlignment ? \"appendTo\" : \"prependTo\"]($cell);\n      };\n\n      function addCssClassesToCellContent(that, $cell, column, $cellContent) {\n        var $indicatorElements = that._getIndicatorElements($cell, true);\n\n        var $visibleIndicatorElements = that._getIndicatorElements($cell);\n\n        var indicatorCount = $indicatorElements && $indicatorElements.length;\n\n        var columnAlignment = that._getColumnAlignment(column.alignment);\n\n        var sortIndicatorClassName = \".\".concat(that._getIndicatorClassName(\"sort\"));\n        var sortIndexIndicatorClassName = \".\".concat(that._getIndicatorClassName(\"sortIndex\"));\n        var $sortIndicator = $visibleIndicatorElements.filter(sortIndicatorClassName);\n        var $sortIndexIndicator = $visibleIndicatorElements.children().filter(sortIndexIndicatorClassName);\n        $cellContent = $cellContent || $cell.children(\".\" + that.addWidgetPrefix(CELL_CONTENT_CLASS));\n        $cellContent.toggleClass(TEXT_CONTENT_ALIGNMENT_CLASS_PREFIX + columnAlignment, indicatorCount > 0).toggleClass(TEXT_CONTENT_ALIGNMENT_CLASS_PREFIX + (\"left\" === columnAlignment ? \"right\" : \"left\"), indicatorCount > 0 && \"center\" === column.alignment).toggleClass(SORT_INDICATOR_CLASS, !!$sortIndicator.length).toggleClass(SORT_INDEX_INDICATOR_CLASS, !!$sortIndexIndicator.length).toggleClass(HEADER_FILTER_INDICATOR_CLASS, !!$visibleIndicatorElements.filter(\".\" + that._getIndicatorClassName(\"headerFilter\")).length);\n      }\n\n      return {\n        _createTable: function _createTable() {\n          var $table = this.callBase.apply(this, arguments);\n          eventsEngine.on($table, \"mousedown selectstart\", this.createAction(function (e) {\n            var event = e.event;\n\n            if (event.shiftKey) {\n              event.preventDefault();\n            }\n          }));\n          return $table;\n        },\n        _isLegacyKeyboardNavigation: function _isLegacyKeyboardNavigation() {\n          return this.option(\"useLegacyKeyboardNavigation\");\n        },\n        _getDefaultTemplate: function _getDefaultTemplate(column) {\n          var that = this;\n          return function ($container, options) {\n            var $content = column.command ? $container : createCellContent(that, $container, options);\n            var caption = \"expand\" !== column.command && column.caption;\n\n            if (caption) {\n              $content.text(caption);\n            } else if (column.command) {\n              $container.html(\"&nbsp;\");\n            }\n          };\n        },\n        _getHeaderTemplate: function _getHeaderTemplate(column) {\n          return column.headerCellTemplate || {\n            allowRenderToDetachedContainer: true,\n            render: this._getDefaultTemplate(column)\n          };\n        },\n        _processTemplate: function _processTemplate(template, options) {\n          var that = this;\n          var resultTemplate;\n          var column = options.column;\n          var renderingTemplate = that.callBase(template);\n\n          if (\"header\" === options.rowType && renderingTemplate && column.headerCellTemplate && !column.command) {\n            resultTemplate = {\n              render: function render(options) {\n                var $content = createCellContent(that, options.container, options.model);\n                renderingTemplate.render(extend({}, options, {\n                  container: $content\n                }));\n              }\n            };\n          } else {\n            resultTemplate = renderingTemplate;\n          }\n\n          return resultTemplate;\n        },\n        _handleDataChanged: function _handleDataChanged(e) {\n          if (\"refresh\" !== e.changeType) {\n            return;\n          }\n\n          if (this._isGroupingChanged || this._requireReady) {\n            this._isGroupingChanged = false;\n            this.render();\n          }\n        },\n        _renderCell: function _renderCell($row, options) {\n          var $cell = this.callBase($row, options);\n\n          if (\"header\" === options.row.rowType) {\n            $cell.addClass(CELL_FOCUS_DISABLED_CLASS);\n\n            if (!this._isLegacyKeyboardNavigation()) {\n              if (options.column && !options.column.type) {\n                $cell.attr(\"tabindex\", this.option(\"tabindex\") || 0);\n              }\n            }\n          }\n\n          return $cell;\n        },\n        _setCellAriaAttributes: function _setCellAriaAttributes($cell, cellOptions) {\n          this.callBase($cell, cellOptions);\n\n          if (\"header\" === cellOptions.rowType) {\n            this.setAria(\"role\", \"columnheader\", $cell);\n\n            if (cellOptions.column && !cellOptions.column.command && !cellOptions.column.isBand) {\n              $cell.attr(\"id\", cellOptions.column.headerId);\n              this.setAria(\"label\", messageLocalization.format(\"dxDataGrid-ariaColumn\") + \" \" + cellOptions.column.caption, $cell);\n            }\n          }\n        },\n        _createRow: function _createRow(row) {\n          var $row = this.callBase.apply(this, arguments);\n          $row.toggleClass(COLUMN_LINES_CLASS, this.option(\"showColumnLines\"));\n\n          if (\"header\" === row.rowType) {\n            $row.addClass(HEADER_ROW_CLASS);\n\n            if (!this._isLegacyKeyboardNavigation()) {\n              registerKeyboardAction(\"columnHeaders\", this, $row, \"td\", this._handleActionKeyDown.bind(this));\n            }\n          }\n\n          return $row;\n        },\n        _handleActionKeyDown: function _handleActionKeyDown(args) {\n          var event = args.event;\n          var $target = $(event.target);\n          this._lastActionElement = event.target;\n\n          if ($target.is(HEADER_FILTER_CLASS_SELECTOR)) {\n            var headerFilterController = this.getController(\"headerFilter\");\n            var $column = $target.closest(\"td\");\n            var columnIndex = this.getColumnIndexByElement($column);\n\n            if (columnIndex >= 0) {\n              headerFilterController.showHeaderFilterMenu(columnIndex, false);\n            }\n          } else {\n            var $row = $target.closest(ROW_CLASS_SELECTOR);\n\n            this._processHeaderAction(event, $row);\n          }\n\n          event.preventDefault();\n        },\n        _renderCore: function _renderCore() {\n          var that = this;\n          var $container = that.element();\n\n          if (that._tableElement && !that._dataController.isLoaded() && !that._hasRowElements) {\n            return;\n          }\n\n          $container.addClass(that.addWidgetPrefix(HEADERS_CLASS)).toggleClass(that.addWidgetPrefix(NOWRAP_CLASS), !that.option(\"wordWrapEnabled\")).empty();\n          that.setAria(\"role\", \"presentation\", $container);\n\n          that._updateContent(that._renderTable());\n\n          if (that.getRowCount() > 1) {\n            $container.addClass(MULTI_ROW_HEADER_CLASS);\n          }\n\n          that.callBase.apply(that, arguments);\n        },\n        _renderRows: function _renderRows() {\n          var that = this;\n\n          if (that._dataController.isLoaded() || that._hasRowElements) {\n            that.callBase.apply(that, arguments);\n            that._hasRowElements = true;\n          }\n        },\n        _getRowVisibleColumns: function _getRowVisibleColumns(rowIndex) {\n          return this._columnsController.getVisibleColumns(rowIndex);\n        },\n        _renderRow: function _renderRow($table, options) {\n          options.columns = this._getRowVisibleColumns(options.row.rowIndex);\n          this.callBase($table, options);\n        },\n        _createCell: function _createCell(options) {\n          var column = options.column;\n          var $cellElement = this.callBase.apply(this, arguments);\n          column.rowspan > 1 && \"header\" === options.rowType && $cellElement.attr(\"rowSpan\", column.rowspan);\n          return $cellElement;\n        },\n        _getRows: function _getRows() {\n          var result = [];\n          var rowCount = this.getRowCount();\n\n          if (this.option(\"showColumnHeaders\")) {\n            for (var i = 0; i < rowCount; i++) {\n              result.push({\n                rowType: \"header\",\n                rowIndex: i\n              });\n            }\n          }\n\n          return result;\n        },\n        _getCellTemplate: function _getCellTemplate(options) {\n          if (\"header\" === options.rowType) {\n            return this._getHeaderTemplate(options.column);\n          }\n        },\n        _columnOptionChanged: function _columnOptionChanged(e) {\n          var changeTypes = e.changeTypes;\n          var optionNames = e.optionNames;\n\n          if (changeTypes.grouping || changeTypes.groupExpanding) {\n            if (changeTypes.grouping) {\n              this._isGroupingChanged = true;\n            }\n\n            return;\n          }\n\n          this.callBase(e);\n\n          if (optionNames.width || optionNames.visible) {\n            this.resizeCompleted.fire();\n          }\n        },\n        _isElementVisible: function _isElementVisible(elementOptions) {\n          return elementOptions && elementOptions.visible;\n        },\n        _alignCaptionByCenter: function _alignCaptionByCenter($cell) {\n          var $indicatorsContainer = this._getIndicatorContainer($cell, true);\n\n          if ($indicatorsContainer && $indicatorsContainer.length) {\n            $indicatorsContainer.filter(\".\" + VISIBILITY_HIDDEN_CLASS).remove();\n            $indicatorsContainer = this._getIndicatorContainer($cell);\n            $indicatorsContainer.clone().addClass(VISIBILITY_HIDDEN_CLASS).css(\"float\", \"\").insertBefore($cell.children(\".\" + this.addWidgetPrefix(CELL_CONTENT_CLASS)));\n          }\n        },\n        _updateCell: function _updateCell($cell, options) {\n          if (\"header\" === options.rowType && \"center\" === options.column.alignment) {\n            this._alignCaptionByCenter($cell);\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _updateIndicator: function _updateIndicator($cell, column, indicatorName) {\n          var $indicatorElement = this.callBase.apply(this, arguments);\n\n          if (\"center\" === column.alignment) {\n            this._alignCaptionByCenter($cell);\n          }\n\n          addCssClassesToCellContent(this, $cell, column);\n          return $indicatorElement;\n        },\n        _getIndicatorContainer: function _getIndicatorContainer($cell, returnAll) {\n          var $indicatorsContainer = this.callBase($cell);\n          return returnAll ? $indicatorsContainer : $indicatorsContainer.filter(\":not(.\" + VISIBILITY_HIDDEN_CLASS + \")\");\n        },\n        _isSortableElement: function _isSortableElement() {\n          return true;\n        },\n        getHeadersRowHeight: function getHeadersRowHeight() {\n          var $tableElement = this.getTableElement();\n          var $headerRows = $tableElement && $tableElement.find(\".\" + HEADER_ROW_CLASS);\n          return $headerRows && $headerRows.toArray().reduce(function (sum, headerRow) {\n            return sum + getHeight(headerRow);\n          }, 0) || 0;\n        },\n        getHeaderElement: function getHeaderElement(index) {\n          var columnElements = this.getColumnElements();\n          return columnElements && columnElements.eq(index);\n        },\n        getColumnElements: function getColumnElements(index, bandColumnIndex) {\n          var that = this;\n          var $cellElement;\n          var columnsController = that._columnsController;\n          var rowCount = that.getRowCount();\n\n          if (that.option(\"showColumnHeaders\")) {\n            if (rowCount > 1 && (!isDefined(index) || isDefined(bandColumnIndex))) {\n              var result = [];\n              var visibleColumns = isDefined(bandColumnIndex) ? columnsController.getChildrenByBandColumn(bandColumnIndex, true) : columnsController.getVisibleColumns();\n              each(visibleColumns, function (_, column) {\n                var rowIndex = isDefined(index) ? index : columnsController.getRowIndex(column.index);\n                $cellElement = that._getCellElement(rowIndex, columnsController.getVisibleIndex(column.index, rowIndex));\n                $cellElement && result.push($cellElement.get(0));\n              });\n              return $(result);\n            } else if (!index || index < rowCount) {\n              return that.getCellElements(index || 0);\n            }\n          }\n        },\n        getColumnIndexByElement: function getColumnIndexByElement($cell) {\n          var cellIndex = this.getCellIndex($cell);\n          var $row = $cell.closest(\".dx-row\");\n          var rowIndex = $row[0].rowIndex;\n          var column = this.getColumns(rowIndex)[cellIndex];\n          return column ? column.index : -1;\n        },\n        getVisibleColumnIndex: function getVisibleColumnIndex(columnIndex, rowIndex) {\n          var column = this.getColumns()[columnIndex];\n          return column ? this._columnsController.getVisibleIndex(column.index, rowIndex) : -1;\n        },\n        getColumnWidths: function getColumnWidths() {\n          var $columnElements = this.getColumnElements();\n\n          if ($columnElements && $columnElements.length) {\n            return this._getWidths($columnElements);\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        allowDragging: function allowDragging(column, sourceLocation, draggingPanels) {\n          var i;\n          var draggableColumnCount = 0;\n\n          var rowIndex = column && this._columnsController.getRowIndex(column.index);\n\n          var columns = this.getColumns(0 === rowIndex ? 0 : null);\n          var canHideColumn = (null === column || void 0 === column ? void 0 : column.allowHiding) && columns.length > 1;\n\n          var allowDrag = function allowDrag(column) {\n            return column.allowReordering || column.allowGrouping || column.allowHiding;\n          };\n\n          for (i = 0; i < columns.length; i++) {\n            if (allowDrag(columns[i])) {\n              draggableColumnCount++;\n            }\n          }\n\n          if (draggableColumnCount <= 1 && !canHideColumn) {\n            return false;\n          } else if (!draggingPanels) {\n            return (this.option(\"allowColumnReordering\") || this._columnsController.isColumnOptionUsed(\"allowReordering\")) && column && column.allowReordering;\n          }\n\n          for (i = 0; i < draggingPanels.length; i++) {\n            var draggingPanel = draggingPanels[i];\n\n            if (draggingPanel && draggingPanel.allowDragging(column, sourceLocation)) {\n              return true;\n            }\n          }\n\n          return false;\n        },\n        getBoundingRect: function getBoundingRect() {\n          var $columnElements = this.getColumnElements();\n\n          if ($columnElements && $columnElements.length) {\n            var offset = this.getTableElement().offset();\n            return {\n              top: offset.top\n            };\n          }\n\n          return null;\n        },\n        getName: function getName() {\n          return \"headers\";\n        },\n        getColumnCount: function getColumnCount() {\n          var $columnElements = this.getColumnElements();\n          return $columnElements ? $columnElements.length : 0;\n        },\n        isVisible: function isVisible() {\n          return this.option(\"showColumnHeaders\");\n        },\n        optionChanged: function optionChanged(args) {\n          switch (args.name) {\n            case \"showColumnHeaders\":\n            case \"wordWrapEnabled\":\n            case \"showColumnLines\":\n              this._invalidate(true, true);\n\n              args.handled = true;\n              break;\n\n            default:\n              this.callBase(args);\n          }\n        },\n        getHeight: function getHeight() {\n          return this.getElementHeight();\n        },\n        getContextMenuItems: function getContextMenuItems(options) {\n          var that = this;\n          var column = options.column;\n\n          if (options.row && (\"header\" === options.row.rowType || \"detailAdaptive\" === options.row.rowType)) {\n            var sortingOptions = that.option(\"sorting\");\n\n            if (sortingOptions && \"none\" !== sortingOptions.mode && column && column.allowSorting) {\n              var onItemClick = function onItemClick(params) {\n                setTimeout(function () {\n                  that._columnsController.changeSortOrder(column.index, params.itemData.value);\n                });\n              };\n\n              return [{\n                text: sortingOptions.ascendingText,\n                value: \"asc\",\n                disabled: \"asc\" === column.sortOrder,\n                icon: CONTEXT_MENU_SORT_ASC_ICON,\n                onItemClick: onItemClick\n              }, {\n                text: sortingOptions.descendingText,\n                value: \"desc\",\n                disabled: \"desc\" === column.sortOrder,\n                icon: CONTEXT_MENU_SORT_DESC_ICON,\n                onItemClick: onItemClick\n              }, {\n                text: sortingOptions.clearText,\n                value: \"none\",\n                disabled: !column.sortOrder,\n                icon: CONTEXT_MENU_SORT_NONE_ICON,\n                onItemClick: onItemClick\n              }];\n            }\n          }\n        },\n        getRowCount: function getRowCount() {\n          return this._columnsController && this._columnsController.getRowCount();\n        },\n        setRowsOpacity: function setRowsOpacity(columnIndex, value, rowIndex) {\n          var that = this;\n          var i;\n          var columnElements;\n          var rowCount = that.getRowCount();\n\n          var columns = that._columnsController.getColumns();\n\n          var column = columns && columns[columnIndex];\n          var columnID = column && column.isBand && column.index;\n\n          var setColumnOpacity = function setColumnOpacity(index, column) {\n            if (column.ownerBand === columnID) {\n              columnElements.eq(index).css({\n                opacity: value\n              });\n\n              if (column.isBand) {\n                that.setRowsOpacity(column.index, value, i + 1);\n              }\n            }\n          };\n\n          if (isDefined(columnID)) {\n            rowIndex = rowIndex || 0;\n\n            for (i = rowIndex; i < rowCount; i++) {\n              columnElements = that.getCellElements(i);\n              each(that.getColumns(i), setColumnOpacity);\n            }\n          }\n        }\n      };\n    }())\n  }\n};","map":null,"metadata":{},"sourceType":"module"}