{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/date_box/ui.date_box.strategy.list.js)\r\n * Version: 21.2.6\r\n * Build date: Tue Mar 01 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getOuterHeight, getHeight } from \"../../core/utils/size\";\nimport { getWindow } from \"../../core/utils/window\";\nvar window = getWindow();\nimport List from \"../list_light\";\nimport \"../list/modules/selection\";\nimport DateBoxStrategy from \"./ui.date_box.strategy\";\nimport { noop, ensureDefined } from \"../../core/utils/common\";\nimport { isDate } from \"../../core/utils/type\";\nimport { extend } from \"../../core/utils/extend\";\nimport dateUtils from \"./ui.date_utils\";\nimport dateLocalization from \"../../localization/date\";\nimport dateSerialization from \"../../core/utils/date_serialization\";\nimport { getSizeValue } from \"../drop_down_editor/utils\";\nvar DATE_FORMAT = \"date\";\nvar BOUNDARY_VALUES = {\n  min: new Date(0, 0, 0, 0, 0),\n  max: new Date(0, 0, 0, 23, 59)\n};\nvar ListStrategy = DateBoxStrategy.inherit({\n  NAME: \"List\",\n  supportedKeys: function supportedKeys() {\n    return {\n      tab: function tab() {\n        var _this$option = this.option(),\n            opened = _this$option.opened,\n            applyValueMode = _this$option.applyValueMode;\n\n        if (opened && \"instantly\" === applyValueMode) {\n          this.close();\n        }\n      },\n      space: noop,\n      home: noop,\n      end: noop\n    };\n  },\n  getDefaultOptions: function getDefaultOptions() {\n    return extend(this.callBase(), {\n      applyValueMode: \"instantly\"\n    });\n  },\n  getDisplayFormat: function getDisplayFormat(displayFormat) {\n    return displayFormat || \"shorttime\";\n  },\n  popupConfig: function popupConfig(_popupConfig) {\n    return _popupConfig;\n  },\n  getValue: function getValue() {\n    var selectedIndex = this._widget.option(\"selectedIndex\");\n\n    if (-1 === selectedIndex) {\n      return this.dateBox.option(\"value\");\n    }\n\n    var itemData = this._widgetItems[selectedIndex];\n    return this._getDateByItemData(itemData);\n  },\n  useCurrentDateByDefault: function useCurrentDateByDefault() {\n    return true;\n  },\n  getDefaultDate: function getDefaultDate() {\n    return new Date(null);\n  },\n  popupShowingHandler: function popupShowingHandler() {\n    this.dateBox._dimensionChanged();\n  },\n  _renderWidget: function _renderWidget() {\n    this.callBase();\n\n    this._refreshItems();\n  },\n  _getWidgetName: function _getWidgetName() {\n    return List;\n  },\n  _getWidgetOptions: function _getWidgetOptions() {\n    return {\n      itemTemplate: this._timeListItemTemplate.bind(this),\n      onItemClick: this._listItemClickHandler.bind(this),\n      tabIndex: -1,\n      onFocusedItemChanged: this._refreshActiveDescendant.bind(this),\n      selectionMode: \"single\"\n    };\n  },\n  _refreshActiveDescendant: function _refreshActiveDescendant(e) {\n    this.dateBox.setAria(\"activedescendant\", \"\");\n    this.dateBox.setAria(\"activedescendant\", e.actionValue);\n  },\n  _refreshItems: function _refreshItems() {\n    this._widgetItems = this._getTimeListItems();\n\n    this._widget.option(\"items\", this._widgetItems);\n  },\n  renderOpenedState: function renderOpenedState() {\n    if (!this._widget) {\n      return;\n    }\n\n    this._widget.option(\"focusedElement\", null);\n\n    this._setSelectedItemsByValue();\n\n    if (this._widget.option(\"templatesRenderAsynchronously\")) {\n      this._asyncScrollTimeout = setTimeout(this._scrollToSelectedItem.bind(this));\n    } else {\n      this._scrollToSelectedItem();\n    }\n  },\n  dispose: function dispose() {\n    this.callBase();\n    clearTimeout(this._asyncScrollTimeout);\n  },\n  _updateValue: function _updateValue() {\n    if (!this._widget) {\n      return;\n    }\n\n    this._refreshItems();\n\n    this._setSelectedItemsByValue();\n\n    this._scrollToSelectedItem();\n  },\n  _setSelectedItemsByValue: function _setSelectedItemsByValue() {\n    var value = this.dateBoxValue();\n\n    var dateIndex = this._getDateIndex(value);\n\n    if (-1 === dateIndex) {\n      this._widget.option(\"selectedItems\", []);\n    } else {\n      this._widget.option(\"selectedIndex\", dateIndex);\n    }\n  },\n  _scrollToSelectedItem: function _scrollToSelectedItem() {\n    this._widget.scrollToItem(this._widget.option(\"selectedIndex\"));\n  },\n  _getDateIndex: function _getDateIndex(date) {\n    var result = -1;\n\n    for (var i = 0, n = this._widgetItems.length; i < n; i++) {\n      if (this._areDatesEqual(date, this._widgetItems[i])) {\n        result = i;\n        break;\n      }\n    }\n\n    return result;\n  },\n  _areDatesEqual: function _areDatesEqual(first, second) {\n    return isDate(first) && isDate(second) && first.getHours() === second.getHours() && first.getMinutes() === second.getMinutes();\n  },\n  _getTimeListItems: function _getTimeListItems() {\n    var min = this.dateBox.dateOption(\"min\") || this._getBoundaryDate(\"min\");\n\n    var max = this.dateBox.dateOption(\"max\") || this._getBoundaryDate(\"max\");\n\n    var value = this.dateBox.dateOption(\"value\") || null;\n    var delta = max - min;\n    var minutes = min.getMinutes() % this.dateBox.option(\"interval\");\n\n    if (delta < 0) {\n      return [];\n    }\n\n    if (delta > dateUtils.ONE_DAY) {\n      delta = dateUtils.ONE_DAY;\n    }\n\n    if (value - min < dateUtils.ONE_DAY) {\n      return this._getRangeItems(min, new Date(min), delta);\n    }\n\n    min = this._getBoundaryDate(\"min\");\n    min.setMinutes(minutes);\n\n    if (value && Math.abs(value - max) < dateUtils.ONE_DAY) {\n      delta = (60 * max.getHours() + Math.abs(max.getMinutes() - minutes)) * dateUtils.ONE_MINUTE;\n    }\n\n    return this._getRangeItems(min, new Date(min), delta);\n  },\n  _getRangeItems: function _getRangeItems(startValue, currentValue, rangeDuration) {\n    var rangeItems = [];\n    var interval = this.dateBox.option(\"interval\");\n\n    while (currentValue - startValue <= rangeDuration) {\n      rangeItems.push(new Date(currentValue));\n      currentValue.setMinutes(currentValue.getMinutes() + interval);\n    }\n\n    return rangeItems;\n  },\n  _getBoundaryDate: function _getBoundaryDate(boundary) {\n    var boundaryValue = BOUNDARY_VALUES[boundary];\n    var currentValue = new Date(ensureDefined(this.dateBox.dateOption(\"value\"), 0));\n    return new Date(currentValue.getFullYear(), currentValue.getMonth(), currentValue.getDate(), boundaryValue.getHours(), boundaryValue.getMinutes());\n  },\n  _timeListItemTemplate: function _timeListItemTemplate(itemData) {\n    var displayFormat = this.dateBox.option(\"displayFormat\");\n    return dateLocalization.format(itemData, this.getDisplayFormat(displayFormat));\n  },\n  _listItemClickHandler: function _listItemClickHandler(e) {\n    if (\"useButtons\" === this.dateBox.option(\"applyValueMode\")) {\n      return;\n    }\n\n    var date = this._getDateByItemData(e.itemData);\n\n    this.dateBox.option(\"opened\", false);\n    this.dateBoxValue(date, e.event);\n  },\n  _getDateByItemData: function _getDateByItemData(itemData) {\n    var date = this.dateBox.option(\"value\");\n    var hours = itemData.getHours();\n    var minutes = itemData.getMinutes();\n    var seconds = itemData.getSeconds();\n    var year = itemData.getFullYear();\n    var month = itemData.getMonth();\n    var day = itemData.getDate();\n\n    if (date) {\n      if (this.dateBox.option(\"dateSerializationFormat\")) {\n        date = dateSerialization.deserializeDate(date);\n      } else {\n        date = new Date(date);\n      }\n\n      date.setHours(hours);\n      date.setMinutes(minutes);\n      date.setSeconds(seconds);\n      date.setFullYear(year);\n      date.setMonth(month);\n      date.setDate(day);\n    } else {\n      date = new Date(year, month, day, hours, minutes, 0, 0);\n    }\n\n    return date;\n  },\n  getKeyboardListener: function getKeyboardListener() {\n    return this._widget;\n  },\n  _updatePopupHeight: function _updatePopupHeight() {\n    var dropDownOptionsHeight = getSizeValue(this.dateBox.option(\"dropDownOptions.height\"));\n\n    if (void 0 === dropDownOptionsHeight || \"auto\" === dropDownOptionsHeight) {\n      this.dateBox._setPopupOption(\"height\", \"auto\");\n\n      var popupHeight = getOuterHeight(this._widget.$element());\n      var maxHeight = .45 * getHeight(window);\n\n      this.dateBox._setPopupOption(\"height\", Math.min(popupHeight, maxHeight));\n    }\n\n    this.dateBox._timeList && this.dateBox._timeList.updateDimensions();\n  },\n  getParsedText: function getParsedText(text, format) {\n    var value = this.callBase(text, format);\n\n    if (value) {\n      value = dateUtils.mergeDates(value, new Date(null), DATE_FORMAT);\n    }\n\n    return value;\n  }\n});\nexport default ListStrategy;","map":null,"metadata":{},"sourceType":"module"}