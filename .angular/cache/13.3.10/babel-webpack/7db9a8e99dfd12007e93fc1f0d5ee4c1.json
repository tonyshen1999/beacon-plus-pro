{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/text_box/text_box.js)\r\n * Version: 21.2.6\r\n * Build date: Tue Mar 01 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport { getWindow } from \"../../core/utils/window\";\nvar window = getWindow();\nimport { inArray } from \"../../core/utils/array\";\nimport { extend } from \"../../core/utils/extend\";\nimport registerComponent from \"../../core/component_registrator\";\nimport TextEditor from \"./ui.text_editor\";\nimport { normalizeKeyName } from \"../../events/utils/index\";\nimport { getOuterWidth, getWidth } from \"../../core/utils/size\";\nvar ignoreKeys = [\"backspace\", \"tab\", \"enter\", \"pageUp\", \"pageDown\", \"end\", \"home\", \"leftArrow\", \"rightArrow\", \"downArrow\", \"upArrow\", \"del\"];\nvar TEXTBOX_CLASS = \"dx-textbox\";\nvar SEARCHBOX_CLASS = \"dx-searchbox\";\nvar ICON_CLASS = \"dx-icon\";\nvar SEARCH_ICON_CLASS = \"dx-icon-search\";\nvar TextBox = TextEditor.inherit({\n  ctor: function ctor(element, options) {\n    if (options) {\n      this._showClearButton = options.showClearButton;\n    }\n\n    this.callBase.apply(this, arguments);\n  },\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      value: \"\",\n      mode: \"text\",\n      maxLength: null\n    });\n  },\n  _initMarkup: function _initMarkup() {\n    this.$element().addClass(TEXTBOX_CLASS);\n    this.callBase();\n    this.setAria(\"role\", \"textbox\");\n  },\n  _renderInputType: function _renderInputType() {\n    this.callBase();\n\n    this._renderSearchMode();\n  },\n  _useTemplates: function _useTemplates() {\n    return false;\n  },\n  _renderProps: function _renderProps() {\n    this.callBase();\n\n    this._toggleMaxLengthProp();\n  },\n  _toggleMaxLengthProp: function _toggleMaxLengthProp() {\n    var maxLength = this._getMaxLength();\n\n    if (maxLength && maxLength > 0) {\n      this._input().attr(\"maxLength\", maxLength);\n    } else {\n      this._input().removeAttr(\"maxLength\");\n    }\n  },\n  _renderSearchMode: function _renderSearchMode() {\n    var $element = this._$element;\n\n    if (\"search\" === this.option(\"mode\")) {\n      $element.addClass(SEARCHBOX_CLASS);\n\n      this._renderSearchIcon();\n\n      if (void 0 === this._showClearButton) {\n        this._showClearButton = this.option(\"showClearButton\");\n        this.option(\"showClearButton\", true);\n      }\n    } else {\n      $element.removeClass(SEARCHBOX_CLASS);\n      this._$searchIcon && this._$searchIcon.remove();\n      this.option(\"showClearButton\", void 0 === this._showClearButton ? this.option(\"showClearButton\") : this._showClearButton);\n      delete this._showClearButton;\n    }\n  },\n  _renderSearchIcon: function _renderSearchIcon() {\n    var $searchIcon = $(\"<div>\").addClass(ICON_CLASS).addClass(SEARCH_ICON_CLASS);\n    $searchIcon.prependTo(this._input().parent());\n    this._$searchIcon = $searchIcon;\n  },\n  _getLabelContainerWidth: function _getLabelContainerWidth() {\n    if (this._$searchIcon) {\n      var $inputContainer = this._input().parent();\n\n      return getWidth($inputContainer) - this._getLabelBeforeWidth();\n    }\n\n    return this.callBase();\n  },\n  _getLabelBeforeWidth: function _getLabelBeforeWidth() {\n    var labelBeforeWidth = this.callBase();\n\n    if (this._$searchIcon) {\n      labelBeforeWidth += getOuterWidth(this._$searchIcon);\n    }\n\n    return labelBeforeWidth;\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"maxLength\":\n        this._toggleMaxLengthProp();\n\n        break;\n\n      case \"mode\":\n        this.callBase(args);\n\n        this._updateLabelWidth();\n\n        break;\n\n      case \"mask\":\n        this.callBase(args);\n\n        this._toggleMaxLengthProp();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _onKeyDownCutOffHandler: function _onKeyDownCutOffHandler(e) {\n    var actualMaxLength = this._getMaxLength();\n\n    if (actualMaxLength && !e.ctrlKey && !this._hasSelection()) {\n      var $input = $(e.target);\n      var key = normalizeKeyName(e);\n\n      this._cutOffExtraChar($input);\n\n      return $input.val().length < actualMaxLength || -1 !== inArray(key, ignoreKeys) || \"\" !== window.getSelection().toString();\n    } else {\n      return true;\n    }\n  },\n  _onChangeCutOffHandler: function _onChangeCutOffHandler(e) {\n    var $input = $(e.target);\n\n    if (this.option(\"maxLength\")) {\n      this._cutOffExtraChar($input);\n    }\n  },\n  _cutOffExtraChar: function _cutOffExtraChar($input) {\n    var actualMaxLength = this._getMaxLength();\n\n    var textInput = $input.val();\n\n    if (actualMaxLength && textInput.length > actualMaxLength) {\n      $input.val(textInput.substr(0, actualMaxLength));\n    }\n  },\n  _getMaxLength: function _getMaxLength() {\n    var isMaskSpecified = !!this.option(\"mask\");\n    return isMaskSpecified ? null : this.option(\"maxLength\");\n  }\n});\nregisterComponent(\"dxTextBox\", TextBox);\nexport default TextBox;","map":null,"metadata":{},"sourceType":"module"}