{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/tag_box.js)\r\n * Version: 21.2.6\r\n * Build date: Tue Mar 01 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getOuterWidth, getHeight } from \"../core/utils/size\";\nimport $ from \"../core/renderer\";\nimport devices from \"../core/devices\";\nimport { data as elementData } from \"../core/element_data\";\nimport eventsEngine from \"../events/core/events_engine\";\nimport registerComponent from \"../core/component_registrator\";\nimport { noop, ensureDefined, equalByValue } from \"../core/utils/common\";\nimport { SelectionFilterCreator as FilterCreator } from \"../core/utils/selection_filter\";\nimport { Deferred, when } from \"../core/utils/deferred\";\nimport { createTextElementHiddenCopy } from \"../core/utils/dom\";\nimport { getPublicElement } from \"../core/element\";\nimport { isDefined, isObject, isString } from \"../core/utils/type\";\nimport { hasWindow } from \"../core/utils/window\";\nimport { extend } from \"../core/utils/extend\";\nimport { inArray } from \"../core/utils/array\";\nimport { each } from \"../core/utils/iterator\";\nimport messageLocalization from \"../localization/message\";\nimport { addNamespace, isCommandKeyPressed, normalizeKeyName } from \"../events/utils/index\";\nimport { name as clickEvent } from \"../events/click\";\nimport caret from \"./text_box/utils.caret\";\nimport { normalizeLoadResult } from \"../data/data_source/utils\";\nimport SelectBox from \"./select_box\";\nimport { BindableTemplate } from \"../core/templates/bindable_template\";\nimport { allowScroll } from \"./text_box/utils.scroll\";\nimport errors from \"./widget/ui.errors\";\nvar TAGBOX_TAG_DATA_KEY = \"dxTagData\";\nvar TAGBOX_CLASS = \"dx-tagbox\";\nvar TAGBOX_TAG_CONTAINER_CLASS = \"dx-tag-container\";\nvar TAGBOX_TAG_CLASS = \"dx-tag\";\nvar TAGBOX_MULTI_TAG_CLASS = \"dx-tagbox-multi-tag\";\nvar TAGBOX_CUSTOM_TAG_CLASS = \"dx-tag-custom\";\nvar TAGBOX_TAG_REMOVE_BUTTON_CLASS = \"dx-tag-remove-button\";\nvar TAGBOX_ONLY_SELECT_CLASS = \"dx-tagbox-only-select\";\nvar TAGBOX_SINGLE_LINE_CLASS = \"dx-tagbox-single-line\";\nvar TAGBOX_POPUP_WRAPPER_CLASS = \"dx-tagbox-popup-wrapper\";\nvar TAGBOX_TAG_CONTENT_CLASS = \"dx-tag-content\";\nvar TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS = \"dx-tagbox-default-template\";\nvar TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS = \"dx-tagbox-custom-template\";\nvar NATIVE_CLICK_CLASS = \"dx-native-click\";\nvar TEXTEDITOR_INPUT_CONTAINER_CLASS = \"dx-texteditor-input-container\";\nvar TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER = -.3;\nvar TagBox = SelectBox.inherit({\n  _supportedKeys: function _supportedKeys() {\n    var _this = this;\n\n    var parent = this.callBase();\n\n    var sendToList = function sendToList(options) {\n      return _this._list._keyboardHandler(options);\n    };\n\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    return extend({}, parent, {\n      backspace: function backspace(e) {\n        if (!this._isCaretAtTheStart()) {\n          return;\n        }\n\n        this._processKeyboardEvent(e);\n\n        this._isTagRemoved = true;\n\n        var $tagToDelete = this._$focusedTag || this._tagElements().last();\n\n        if (this._$focusedTag) {\n          this._moveTagFocus(\"prev\", true);\n        }\n\n        if (0 === $tagToDelete.length) {\n          return;\n        }\n\n        this._preserveFocusedTag = true;\n\n        this._removeTagElement($tagToDelete);\n\n        delete this._preserveFocusedTag;\n      },\n      upArrow: function upArrow(e, opts) {\n        return e.altKey || !_this._list ? parent.upArrow.call(_this, e) : sendToList(opts);\n      },\n      downArrow: function downArrow(e, opts) {\n        return e.altKey || !_this._list ? parent.downArrow.call(_this, e) : sendToList(opts);\n      },\n      del: function del(e) {\n        if (!this._$focusedTag || !this._isCaretAtTheStart()) {\n          return;\n        }\n\n        this._processKeyboardEvent(e);\n\n        this._isTagRemoved = true;\n        var $tagToDelete = this._$focusedTag;\n\n        this._moveTagFocus(\"next\", true);\n\n        this._preserveFocusedTag = true;\n\n        this._removeTagElement($tagToDelete);\n\n        delete this._preserveFocusedTag;\n      },\n      enter: function enter(e, options) {\n        var isListItemFocused = this._list && null !== this._list.option(\"focusedElement\");\n\n        var isCustomItem = this.option(\"acceptCustomValue\") && !isListItemFocused;\n\n        if (isCustomItem) {\n          e.preventDefault();\n          \"\" !== this._searchValue() && this._customItemAddedHandler(e);\n          return;\n        }\n\n        if (this.option(\"opened\")) {\n          this._saveValueChangeEvent(e);\n\n          sendToList(options);\n          e.preventDefault();\n        }\n      },\n      space: function space(e, options) {\n        var isOpened = this.option(\"opened\");\n\n        var isInputActive = this._shouldRenderSearchEvent();\n\n        if (isOpened && !isInputActive) {\n          this._saveValueChangeEvent(e);\n\n          sendToList(options);\n          e.preventDefault();\n        }\n      },\n      leftArrow: function leftArrow(e) {\n        if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && rtlEnabled && !this._$focusedTag) {\n          return;\n        }\n\n        e.preventDefault();\n        var direction = rtlEnabled ? \"next\" : \"prev\";\n\n        this._moveTagFocus(direction);\n\n        !this.option(\"multiline\") && this._scrollContainer(direction);\n      },\n      rightArrow: function rightArrow(e) {\n        if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && !rtlEnabled && !this._$focusedTag) {\n          return;\n        }\n\n        e.preventDefault();\n        var direction = rtlEnabled ? \"prev\" : \"next\";\n\n        this._moveTagFocus(direction);\n\n        !this.option(\"multiline\") && this._scrollContainer(direction);\n      }\n    });\n  },\n  _processKeyboardEvent: function _processKeyboardEvent(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this._saveValueChangeEvent(e);\n  },\n  _isEmpty: function _isEmpty() {\n    return 0 === this._getValue().length;\n  },\n  _updateTagsContainer: function _updateTagsContainer($element) {\n    this._$tagsContainer = $element.addClass(TAGBOX_TAG_CONTAINER_CLASS).addClass(NATIVE_CLICK_CLASS);\n\n    this._$tagsContainer.parent().addClass(NATIVE_CLICK_CLASS);\n  },\n  _allowSelectItemByTab: function _allowSelectItemByTab() {\n    return false;\n  },\n  _isCaretAtTheStart: function _isCaretAtTheStart() {\n    var position = caret(this._input());\n    return 0 === position.start && 0 === position.end;\n  },\n  _moveTagFocus: function _moveTagFocus(direction, clearOnBoundary) {\n    if (!this._$focusedTag) {\n      var tagElements = this._tagElements();\n\n      this._$focusedTag = \"next\" === direction ? tagElements.first() : tagElements.last();\n\n      this._toggleFocusClass(true, this._$focusedTag);\n\n      return;\n    }\n\n    var $nextFocusedTag = this._$focusedTag[direction](\".\".concat(TAGBOX_TAG_CLASS));\n\n    if ($nextFocusedTag.length > 0) {\n      this._replaceFocusedTag($nextFocusedTag);\n    } else if (clearOnBoundary || \"next\" === direction && this._isEditable()) {\n      this._clearTagFocus();\n    }\n  },\n  _replaceFocusedTag: function _replaceFocusedTag($nextFocusedTag) {\n    this._toggleFocusClass(false, this._$focusedTag);\n\n    this._$focusedTag = $nextFocusedTag;\n\n    this._toggleFocusClass(true, this._$focusedTag);\n  },\n  _clearTagFocus: function _clearTagFocus() {\n    if (!this._$focusedTag) {\n      return;\n    }\n\n    this._toggleFocusClass(false, this._$focusedTag);\n\n    delete this._$focusedTag;\n  },\n  _focusClassTarget: function _focusClassTarget($element) {\n    if ($element && $element.length && $element[0] !== this._focusTarget()[0]) {\n      return $element;\n    }\n\n    return this.callBase();\n  },\n  _getLabelContainer: function _getLabelContainer() {\n    return this._$tagsContainer;\n  },\n  _scrollContainer: function _scrollContainer(direction) {\n    if (this.option(\"multiline\") || !hasWindow()) {\n      return;\n    }\n\n    if (!this._$tagsContainer) {\n      return;\n    }\n\n    var scrollPosition = this._getScrollPosition(direction);\n\n    this._$tagsContainer.scrollLeft(scrollPosition);\n  },\n  _getScrollPosition: function _getScrollPosition(direction) {\n    if (\"start\" === direction || \"end\" === direction) {\n      return this._getBorderPosition(direction);\n    }\n\n    return this._$focusedTag ? this._getFocusedTagPosition(direction) : this._getBorderPosition(\"end\");\n  },\n  _getBorderPosition: function _getBorderPosition(direction) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var isScrollLeft = \"end\" === direction ^ rtlEnabled;\n    var scrollSign = rtlEnabled ? -1 : 1;\n    return isScrollLeft ^ !rtlEnabled ? 0 : scrollSign * (this._$tagsContainer.get(0).scrollWidth - getOuterWidth(this._$tagsContainer));\n  },\n  _getFocusedTagPosition: function _getFocusedTagPosition(direction) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var isScrollLeft = \"next\" === direction ^ rtlEnabled;\n\n    var _this$_$focusedTag$po = this._$focusedTag.position(),\n        scrollOffset = _this$_$focusedTag$po.left;\n\n    var scrollLeft = this._$tagsContainer.scrollLeft();\n\n    if (isScrollLeft) {\n      scrollOffset += getOuterWidth(this._$focusedTag, true) - getOuterWidth(this._$tagsContainer);\n    }\n\n    if (isScrollLeft ^ scrollOffset < 0) {\n      scrollLeft += scrollOffset;\n    }\n\n    return scrollLeft;\n  },\n  _setNextValue: noop,\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      value: [],\n      showDropDownButton: false,\n      maxFilterQueryLength: 1500,\n      tagTemplate: \"tag\",\n      selectAllText: messageLocalization.format(\"dxList-selectAll\"),\n      hideSelectedItems: false,\n      selectedItems: [],\n      selectAllMode: \"page\",\n      onSelectAllValueChanged: null,\n      maxDisplayedTags: void 0,\n      showMultiTagOnly: true,\n      onMultiTagPreparing: null,\n      multiline: true,\n      useSubmitBehavior: true\n    });\n  },\n  _init: function _init() {\n    this.callBase();\n    this._selectedItems = [];\n\n    this._initSelectAllValueChangedAction();\n  },\n  _initActions: function _initActions() {\n    this.callBase();\n\n    this._initMultiTagPreparingAction();\n  },\n  _initMultiTagPreparingAction: function _initMultiTagPreparingAction() {\n    this._multiTagPreparingAction = this._createActionByOption(\"onMultiTagPreparing\", {\n      beforeExecute: function (e) {\n        this._multiTagPreparingHandler(e.args[0]);\n      }.bind(this),\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n  },\n  _multiTagPreparingHandler: function _multiTagPreparingHandler(args) {\n    var _this$_getValue = this._getValue(),\n        selectedCount = _this$_getValue.length;\n\n    if (!this.option(\"showMultiTagOnly\")) {\n      args.text = messageLocalization.getFormatter(\"dxTagBox-moreSelected\")(selectedCount - this.option(\"maxDisplayedTags\") + 1);\n    } else {\n      args.text = messageLocalization.getFormatter(\"dxTagBox-selected\")(selectedCount);\n    }\n  },\n  _initDynamicTemplates: function _initDynamicTemplates() {\n    this.callBase();\n\n    this._templateManager.addDefaultTemplates({\n      tag: new BindableTemplate(function ($container, data) {\n        var _data$text;\n\n        var $tagContent = $(\"<div>\").addClass(TAGBOX_TAG_CONTENT_CLASS);\n        $(\"<span>\").text(null !== (_data$text = data.text) && void 0 !== _data$text ? _data$text : data).appendTo($tagContent);\n        $(\"<div>\").addClass(TAGBOX_TAG_REMOVE_BUTTON_CLASS).appendTo($tagContent);\n        $container.append($tagContent);\n      }, [\"text\"], this.option(\"integrationOptions.watchMethod\"), {\n        text: this._displayGetter\n      })\n    });\n  },\n  _toggleSubmitElement: function _toggleSubmitElement(enabled) {\n    if (enabled) {\n      this._renderSubmitElement();\n\n      this._setSubmitValue();\n    } else {\n      this._$submitElement && this._$submitElement.remove();\n      delete this._$submitElement;\n    }\n  },\n  _renderSubmitElement: function _renderSubmitElement() {\n    if (!this.option(\"useSubmitBehavior\")) {\n      return;\n    }\n\n    this._$submitElement = $(\"<select>\").attr(\"multiple\", \"multiple\").css(\"display\", \"none\").appendTo(this.$element());\n  },\n  _setSubmitValue: function _setSubmitValue() {\n    if (!this.option(\"useSubmitBehavior\")) {\n      return;\n    }\n\n    var value = this._getValue();\n\n    var $options = [];\n\n    for (var i = 0, n = value.length; i < n; i++) {\n      var useDisplayText = this._shouldUseDisplayValue(value[i]);\n\n      $options.push($(\"<option>\").val(useDisplayText ? this._displayGetter(value[i]) : value[i]).attr(\"selected\", \"selected\"));\n    }\n\n    this._getSubmitElement().empty().append($options);\n  },\n  _initMarkup: function _initMarkup() {\n    this._tagElementsCache = $();\n    var isSingleLineMode = !this.option(\"multiline\");\n    this.$element().addClass(TAGBOX_CLASS).toggleClass(TAGBOX_ONLY_SELECT_CLASS, !(this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\"))).toggleClass(TAGBOX_SINGLE_LINE_CLASS, isSingleLineMode);\n\n    this._initTagTemplate();\n\n    this.callBase();\n  },\n  _render: function _render() {\n    this.callBase();\n\n    this._renderTagRemoveAction();\n\n    this._renderSingleLineScroll();\n\n    this._scrollContainer(\"start\");\n  },\n  _initTagTemplate: function _initTagTemplate() {\n    this._tagTemplate = this._getTemplateByOption(\"tagTemplate\");\n  },\n  _renderField: function _renderField() {\n    var isDefaultFieldTemplate = !isDefined(this.option(\"fieldTemplate\"));\n    this.$element().toggleClass(TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS, isDefaultFieldTemplate).toggleClass(TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS, !isDefaultFieldTemplate);\n    this.callBase();\n  },\n  _renderTagRemoveAction: function _renderTagRemoveAction() {\n    var tagRemoveAction = this._createAction(this._removeTagHandler.bind(this));\n\n    var eventName = addNamespace(clickEvent, \"dxTagBoxTagRemove\");\n    eventsEngine.off(this._$tagsContainer, eventName);\n    eventsEngine.on(this._$tagsContainer, eventName, \".\".concat(TAGBOX_TAG_REMOVE_BUTTON_CLASS), function (event) {\n      tagRemoveAction({\n        event: event\n      });\n    });\n  },\n  _renderSingleLineScroll: function _renderSingleLineScroll() {\n    var mouseWheelEvent = addNamespace(\"dxmousewheel\", this.NAME);\n    var $element = this.$element();\n    var isMultiline = this.option(\"multiline\");\n    eventsEngine.off($element, mouseWheelEvent);\n\n    if (\"desktop\" !== devices.real().deviceType) {\n      this._$tagsContainer && this._$tagsContainer.css(\"overflowX\", isMultiline ? \"\" : \"auto\");\n      return;\n    }\n\n    if (isMultiline) {\n      return;\n    }\n\n    eventsEngine.on($element, mouseWheelEvent, this._tagContainerMouseWheelHandler.bind(this));\n  },\n  _tagContainerMouseWheelHandler: function _tagContainerMouseWheelHandler(e) {\n    var scrollLeft = this._$tagsContainer.scrollLeft();\n\n    var delta = e.delta * TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER;\n\n    if (!isCommandKeyPressed(e) && allowScroll(this._$tagsContainer, delta, true)) {\n      this._$tagsContainer.scrollLeft(scrollLeft + delta);\n\n      return false;\n    }\n  },\n  _renderEvents: function _renderEvents() {\n    var _this2 = this;\n\n    this.callBase();\n\n    var input = this._input();\n\n    var namespace = addNamespace(\"keydown\", this.NAME);\n    eventsEngine.on(input, namespace, function (e) {\n      var keyName = normalizeKeyName(e);\n\n      if (!_this2._isControlKey(keyName) && _this2._isEditable()) {\n        _this2._clearTagFocus();\n      }\n    });\n  },\n  _popupWrapperClass: function _popupWrapperClass() {\n    return this.callBase() + \" \" + TAGBOX_POPUP_WRAPPER_CLASS;\n  },\n  _renderInput: function _renderInput() {\n    this.callBase();\n\n    this._renderPreventBlurOnInputClick();\n  },\n  _renderPreventBlurOnInputClick: function _renderPreventBlurOnInputClick() {\n    var _this3 = this;\n\n    var eventName = addNamespace(\"mousedown\", \"dxTagBox\");\n    eventsEngine.off(this._inputWrapper(), eventName);\n    eventsEngine.on(this._inputWrapper(), eventName, function (e) {\n      if (e.target !== _this3._input()[0]) {\n        e.preventDefault();\n      }\n    });\n  },\n  _renderInputValueImpl: function _renderInputValueImpl() {\n    return this._renderMultiSelect();\n  },\n  _loadInputValue: function _loadInputValue() {\n    return when();\n  },\n  _clearTextValue: function _clearTextValue() {\n    this._input().val(\"\");\n\n    this._toggleEmptinessEventHandler();\n\n    this.option(\"text\", \"\");\n  },\n  _focusInHandler: function _focusInHandler(e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this._scrollContainer(\"end\");\n    }\n\n    this.callBase(e);\n  },\n  _renderInputValue: function _renderInputValue() {\n    this.option(\"displayValue\", this._searchValue());\n    return this.callBase();\n  },\n  _restoreInputText: function _restoreInputText(saveEditingValue) {\n    if (!saveEditingValue) {\n      this._clearTextValue();\n    }\n  },\n  _focusOutHandler: function _focusOutHandler(e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this._clearTagFocus();\n\n      this._scrollContainer(\"start\");\n    }\n\n    this.callBase(e);\n  },\n  _getFirstPopupElement: function _getFirstPopupElement() {\n    return this.option(\"showSelectionControls\") ? this._list.$element() : this.callBase();\n  },\n  _initSelectAllValueChangedAction: function _initSelectAllValueChangedAction() {\n    this._selectAllValueChangeAction = this._createActionByOption(\"onSelectAllValueChanged\");\n  },\n  _renderList: function _renderList() {\n    var _this4 = this;\n\n    this.callBase();\n\n    this._setListDataSourceFilter();\n\n    if (this.option(\"showSelectionControls\")) {\n      this._list.registerKeyHandler(\"tab\", function (e) {\n        return _this4._popupElementTabHandler(e);\n      });\n\n      this._list.registerKeyHandler(\"escape\", function (e) {\n        return _this4._popupElementEscHandler(e);\n      });\n    }\n  },\n  _canListHaveFocus: function _canListHaveFocus() {\n    return \"useButtons\" === this.option(\"applyValueMode\");\n  },\n  _listConfig: function _listConfig() {\n    var _this5 = this;\n\n    var selectionMode = this.option(\"showSelectionControls\") ? \"all\" : \"multiple\";\n    return extend(this.callBase(), {\n      selectionMode: selectionMode,\n      selectAllText: this.option(\"selectAllText\"),\n      onSelectAllValueChanged: function onSelectAllValueChanged(_ref) {\n        var value = _ref.value;\n\n        _this5._selectAllValueChangeAction({\n          value: value\n        });\n      },\n      selectAllMode: this.option(\"selectAllMode\"),\n      selectedItems: this._selectedItems,\n      onFocusedItemChanged: null\n    });\n  },\n  _renderMultiSelect: function _renderMultiSelect() {\n    var _this6 = this;\n\n    var d = new Deferred();\n\n    this._updateTagsContainer(this._$textEditorInputContainer);\n\n    this._renderInputSize();\n\n    this._renderTags().done(function () {\n      _this6._popup && _this6._popup.refreshPosition();\n      d.resolve();\n    }).fail(d.reject);\n\n    return d.promise();\n  },\n  _listItemClickHandler: function _listItemClickHandler(e) {\n    !this.option(\"showSelectionControls\") && this._clearTextValue();\n\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      return;\n    }\n\n    this.callBase(e);\n\n    this._saveValueChangeEvent(void 0);\n  },\n  _shouldClearFilter: function _shouldClearFilter() {\n    var shouldClearFilter = this.callBase();\n    var showSelectionControls = this.option(\"showSelectionControls\");\n    return !showSelectionControls && shouldClearFilter;\n  },\n  _renderInputSize: function _renderInputSize() {\n    var $input = this._input();\n\n    var value = $input.val();\n    var isEmptyInput = isString(value) && value;\n    var width = \"\";\n    var size = \"\";\n    var canTypeText = this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\n\n    if (isEmptyInput && canTypeText) {\n      var $calculationElement = createTextElementHiddenCopy($input, value, {\n        includePaddings: true\n      });\n      $calculationElement.insertAfter($input);\n      width = getOuterWidth($calculationElement) + 5;\n      $calculationElement.remove();\n    } else if (!value) {\n      size = 1;\n    }\n\n    $input.css(\"width\", width);\n    $input.attr(\"size\", size);\n  },\n  _renderInputSubstitution: function _renderInputSubstitution() {\n    this.callBase();\n\n    this._updateWidgetHeight();\n  },\n  _getValue: function _getValue() {\n    return this.option(\"value\") || [];\n  },\n  _multiTagRequired: function _multiTagRequired() {\n    var values = this._getValue();\n\n    var maxDisplayedTags = this.option(\"maxDisplayedTags\");\n    return isDefined(maxDisplayedTags) && values.length > maxDisplayedTags;\n  },\n  _renderMultiTag: function _renderMultiTag($input) {\n    var $tag = $(\"<div>\").addClass(TAGBOX_TAG_CLASS).addClass(TAGBOX_MULTI_TAG_CLASS);\n    var args = {\n      multiTagElement: getPublicElement($tag),\n      selectedItems: this.option(\"selectedItems\")\n    };\n\n    this._multiTagPreparingAction(args);\n\n    if (args.cancel) {\n      return false;\n    }\n\n    $tag.data(TAGBOX_TAG_DATA_KEY, args.text);\n    $tag.insertBefore($input);\n\n    this._tagTemplate.render({\n      model: args.text,\n      container: getPublicElement($tag)\n    });\n\n    return $tag;\n  },\n  _getFilter: function _getFilter(creator) {\n    var dataSourceFilter = this._dataSource.filter();\n\n    var filterExpr = creator.getCombinedFilter(this.option(\"valueExpr\"), dataSourceFilter);\n    var filterQueryLength = encodeURI(JSON.stringify(filterExpr)).length;\n    var maxFilterQueryLength = this.option(\"maxFilterQueryLength\");\n\n    if (filterQueryLength <= maxFilterQueryLength) {\n      return filterExpr;\n    }\n\n    errors.log(\"W1019\", maxFilterQueryLength);\n  },\n  _getFilteredItems: function _getFilteredItems(values) {\n    var _this7 = this;\n\n    var _this$_loadFilteredIt, _this$_list, _this$_list$getDataSo;\n\n    null === (_this$_loadFilteredIt = this._loadFilteredItemsPromise) || void 0 === _this$_loadFilteredIt ? void 0 : _this$_loadFilteredIt.reject();\n    var creator = new FilterCreator(values);\n    var listSelectedItems = null === (_this$_list = this._list) || void 0 === _this$_list ? void 0 : _this$_list.option(\"selectedItems\");\n    var isListItemsLoaded = !!listSelectedItems && (null === (_this$_list$getDataSo = this._list.getDataSource()) || void 0 === _this$_list$getDataSo ? void 0 : _this$_list$getDataSo.isLoaded());\n    var selectedItems = listSelectedItems || this.option(\"selectedItems\");\n    var clientFilterFunction = creator.getLocalFilter(this._valueGetter);\n    var filteredItems = selectedItems.filter(clientFilterFunction);\n    var selectedItemsAlreadyLoaded = filteredItems.length === values.length;\n    var d = new Deferred();\n    var dataSource = this._dataSource;\n\n    if (!dataSource) {\n      return d.resolve([]).promise();\n    } else if ((!this._isDataSourceChanged || isListItemsLoaded) && selectedItemsAlreadyLoaded) {\n      return d.resolve(filteredItems).promise();\n    } else {\n      var _dataSource$loadOptio = dataSource.loadOptions(),\n          customQueryParams = _dataSource$loadOptio.customQueryParams,\n          expand = _dataSource$loadOptio.expand,\n          select = _dataSource$loadOptio.select;\n\n      var filter = this._getFilter(creator);\n\n      dataSource.store().load({\n        filter: filter,\n        customQueryParams: customQueryParams,\n        expand: expand,\n        select: select\n      }).done(function (data, extra) {\n        _this7._isDataSourceChanged = false;\n\n        if (_this7._disposed) {\n          d.reject();\n          return;\n        }\n\n        var _normalizeLoadResult = normalizeLoadResult(data, extra),\n            items = _normalizeLoadResult.data;\n\n        var mappedItems = dataSource._applyMapFunction(items);\n\n        d.resolve(mappedItems.filter(clientFilterFunction));\n      }).fail(d.reject);\n      this._loadFilteredItemsPromise = d;\n      return d.promise();\n    }\n  },\n  _createTagsData: function _createTagsData(values, filteredItems) {\n    var _this8 = this;\n\n    var items = [];\n    var cache = {};\n\n    var isValueExprSpecified = \"this\" === this._valueGetterExpr();\n\n    var filteredValues = {};\n    filteredItems.forEach(function (filteredItem) {\n      var filteredItemValue = isValueExprSpecified ? JSON.stringify(filteredItem) : _this8._valueGetter(filteredItem);\n      filteredValues[filteredItemValue] = filteredItem;\n    });\n    var loadItemPromises = [];\n    values.forEach(function (value, index) {\n      var currentItem = filteredValues[isValueExprSpecified ? JSON.stringify(value) : value];\n\n      if (isValueExprSpecified && !isDefined(currentItem)) {\n        loadItemPromises.push(_this8._loadItem(value, cache).always(function (item) {\n          var newItem = _this8._createTagData(items, item, value, index);\n\n          items.splice(index, 0, newItem);\n        }));\n      } else {\n        var newItem = _this8._createTagData(items, currentItem, value, index);\n\n        items.splice(index, 0, newItem);\n      }\n    });\n    var d = new Deferred();\n    when.apply(this, loadItemPromises).always(function () {\n      d.resolve(items);\n    });\n    return d.promise();\n  },\n  _createTagData: function _createTagData(items, item, value, valueIndex) {\n    if (isDefined(item)) {\n      this._selectedItems.push(item);\n\n      return item;\n    } else {\n      var selectedItem = this.option(\"selectedItem\");\n      var customItem = this._valueGetter(selectedItem) === value ? selectedItem : value;\n      return customItem;\n    }\n  },\n  _isGroupedData: function _isGroupedData() {\n    var _this$_dataSource;\n\n    return this.option(\"grouped\") && !(null !== (_this$_dataSource = this._dataSource) && void 0 !== _this$_dataSource && _this$_dataSource.group());\n  },\n  _getItemsByValues: function _getItemsByValues(values) {\n    var resultItems = [];\n    values.forEach(function (value) {\n      var item = this._getItemFromPlain(value);\n\n      if (isDefined(item)) {\n        resultItems.push(item);\n      }\n    }.bind(this));\n    return resultItems;\n  },\n  _getFilteredGroupedItems: function _getFilteredGroupedItems(values) {\n    var _this9 = this;\n\n    var selectedItems = new Deferred();\n\n    if (!this._dataSource) {\n      return selectedItems.promise();\n    }\n\n    if (this._filteredGroupedItemsLoadPromise) {\n      this._dataSource.cancel(this._filteredGroupedItemsLoadPromise.operationId);\n    }\n\n    if (!this._dataSource.items().length) {\n      this._filteredGroupedItemsLoadPromise = this._dataSource.load().done(function () {\n        selectedItems.resolve(_this9._getItemsByValues(values));\n      }).fail(function () {\n        selectedItems.resolve([]);\n      }).always(function () {\n        _this9._filteredGroupedItemsLoadPromise = void 0;\n      });\n    } else {\n      selectedItems.resolve(this._getItemsByValues(values));\n    }\n\n    return selectedItems.promise();\n  },\n  _loadTagsData: function _loadTagsData() {\n    var _this10 = this;\n\n    var values = this._getValue();\n\n    var tagData = new Deferred();\n    this._selectedItems = [];\n    var filteredItemsPromise = this._isGroupedData() ? this._getFilteredGroupedItems(values) : this._getFilteredItems(values);\n    filteredItemsPromise.done(function (filteredItems) {\n      var items = _this10._createTagsData(values, filteredItems);\n\n      items.always(function (data) {\n        tagData.resolve(data);\n      });\n    }).fail(tagData.reject.bind(this));\n    return tagData.promise();\n  },\n  _renderTags: function _renderTags() {\n    var _this11 = this;\n\n    var d = new Deferred();\n    var isPlainDataUsed = false;\n\n    if (this._shouldGetItemsFromPlain(this._valuesToUpdate)) {\n      this._selectedItems = this._getItemsFromPlain(this._valuesToUpdate);\n\n      if (this._selectedItems.length === this._valuesToUpdate.length) {\n        this._renderTagsImpl(this._selectedItems);\n\n        isPlainDataUsed = true;\n        d.resolve();\n      }\n    }\n\n    if (!isPlainDataUsed) {\n      this._loadTagsData().done(function (items) {\n        if (_this11._disposed) {\n          d.reject();\n          return;\n        }\n\n        _this11._renderTagsImpl(items);\n\n        d.resolve();\n      }).fail(d.reject);\n    }\n\n    return d.promise();\n  },\n  _renderTagsImpl: function _renderTagsImpl(items) {\n    this._renderTagsCore(items);\n\n    this._renderEmptyState();\n\n    if (!this._preserveFocusedTag) {\n      this._clearTagFocus();\n    }\n  },\n  _shouldGetItemsFromPlain: function _shouldGetItemsFromPlain(values) {\n    return values && this._dataSource.isLoaded() && values.length <= this._getPlainItems().length;\n  },\n  _getItemsFromPlain: function _getItemsFromPlain(values) {\n    var selectedItems = this._getSelectedItemsFromList(values);\n\n    var needFilterPlainItems = 0 === selectedItems.length && values.length > 0 || selectedItems.length < values.length;\n\n    if (needFilterPlainItems) {\n      var plainItems = this._getPlainItems();\n\n      selectedItems = this._filterSelectedItems(plainItems, values);\n    }\n\n    return selectedItems;\n  },\n  _getSelectedItemsFromList: function _getSelectedItemsFromList(values) {\n    var _this$_list2;\n\n    var listSelectedItems = null === (_this$_list2 = this._list) || void 0 === _this$_list2 ? void 0 : _this$_list2.option(\"selectedItems\");\n    var selectedItems = [];\n\n    if (values.length === (null === listSelectedItems || void 0 === listSelectedItems ? void 0 : listSelectedItems.length)) {\n      selectedItems = this._filterSelectedItems(listSelectedItems, values);\n    }\n\n    return selectedItems;\n  },\n  _filterSelectedItems: function _filterSelectedItems(plainItems, values) {\n    var _this12 = this;\n\n    var selectedItems = plainItems.filter(function (dataItem) {\n      var currentValue;\n\n      for (var i = 0; i < values.length; i++) {\n        currentValue = values[i];\n\n        if (isObject(currentValue)) {\n          if (_this12._isValueEquals(dataItem, currentValue)) {\n            return true;\n          }\n        } else if (_this12._isValueEquals(_this12._valueGetter(dataItem), currentValue)) {\n          return true;\n        }\n      }\n\n      return false;\n    }, this);\n    return selectedItems;\n  },\n  _integrateInput: function _integrateInput() {\n    this._isInputReady.resolve();\n\n    this.callBase();\n\n    this._updateTagsContainer($(\".\".concat(TEXTEDITOR_INPUT_CONTAINER_CLASS)));\n\n    this._renderTagRemoveAction();\n  },\n  _renderTagsCore: function _renderTagsCore(items) {\n    var _this13 = this;\n\n    var _this$_isInputReady;\n\n    null === (_this$_isInputReady = this._isInputReady) || void 0 === _this$_isInputReady ? void 0 : _this$_isInputReady.reject();\n    this._isInputReady = new Deferred();\n\n    this._renderField();\n\n    this.option(\"selectedItems\", this._selectedItems.slice());\n\n    this._cleanTags();\n\n    if (this._input().length > 0) {\n      this._isInputReady.resolve();\n    }\n\n    when(this._isInputReady).done(function () {\n      _this13._renderTagsElements(items);\n    });\n  },\n  _renderTagsElements: function _renderTagsElements(items) {\n    var _this14 = this;\n\n    var $multiTag = this._multiTagRequired() && this._renderMultiTag(this._input());\n\n    var showMultiTagOnly = this.option(\"showMultiTagOnly\");\n    var maxDisplayedTags = this.option(\"maxDisplayedTags\");\n    items.forEach(function (item, index) {\n      if ($multiTag && showMultiTagOnly || $multiTag && !showMultiTagOnly && index - maxDisplayedTags >= -1) {\n        return false;\n      }\n\n      _this14._renderTag(item, $multiTag || _this14._input());\n    });\n\n    if (this._isFocused()) {\n      this._scrollContainer(\"end\");\n    }\n\n    this._refreshTagElements();\n  },\n  _cleanTags: function _cleanTags() {\n    if (this._multiTagRequired()) {\n      this._tagElements().remove();\n    } else {\n      var $tags = this._tagElements();\n\n      var values = this._getValue();\n\n      each($tags, function (_, tag) {\n        var $tag = $(tag);\n        var index = inArray($tag.data(TAGBOX_TAG_DATA_KEY), values);\n\n        if (index < 0) {\n          $tag.remove();\n        }\n      });\n    }\n  },\n  _renderEmptyState: function _renderEmptyState() {\n    var isEmpty = !(this._getValue().length || this._selectedItems.length || this._searchValue());\n\n    this._toggleEmptiness(isEmpty);\n\n    this._renderDisplayText();\n  },\n  _renderDisplayText: function _renderDisplayText() {\n    this._renderInputSize();\n  },\n  _refreshTagElements: function _refreshTagElements() {\n    this._tagElementsCache = this.$element().find(\".\".concat(TAGBOX_TAG_CLASS));\n  },\n  _tagElements: function _tagElements() {\n    return this._tagElementsCache;\n  },\n  _applyTagTemplate: function _applyTagTemplate(item, $tag) {\n    this._tagTemplate.render({\n      model: item,\n      container: getPublicElement($tag)\n    });\n  },\n  _renderTag: function _renderTag(item, $input) {\n    var value = this._valueGetter(item);\n\n    if (!isDefined(value)) {\n      return;\n    }\n\n    var $tag = this._getTag(value);\n\n    var displayValue = this._displayGetter(item);\n\n    var itemModel = this._getItemModel(item, displayValue);\n\n    if ($tag) {\n      if (isDefined(displayValue)) {\n        $tag.empty();\n\n        this._applyTagTemplate(itemModel, $tag);\n      }\n\n      $tag.removeClass(TAGBOX_CUSTOM_TAG_CLASS);\n    } else {\n      $tag = this._createTag(value, $input);\n\n      if (isDefined(item)) {\n        this._applyTagTemplate(itemModel, $tag);\n      } else {\n        $tag.addClass(TAGBOX_CUSTOM_TAG_CLASS);\n\n        this._applyTagTemplate(value, $tag);\n      }\n    }\n  },\n  _getItemModel: function _getItemModel(item, displayValue) {\n    if (isObject(item) && isDefined(displayValue)) {\n      return item;\n    } else {\n      return ensureDefined(displayValue, \"\");\n    }\n  },\n  _getTag: function _getTag(value) {\n    var $tags = this._tagElements();\n\n    var tagsLength = $tags.length;\n    var result = false;\n\n    for (var i = 0; i < tagsLength; i++) {\n      var $tag = $tags[i];\n      var tagData = elementData($tag, TAGBOX_TAG_DATA_KEY);\n\n      if (value === tagData || equalByValue(value, tagData)) {\n        result = $($tag);\n        break;\n      }\n    }\n\n    return result;\n  },\n  _createTag: function _createTag(value, $input) {\n    return $(\"<div>\").addClass(TAGBOX_TAG_CLASS).data(TAGBOX_TAG_DATA_KEY, value).insertBefore($input);\n  },\n  _toggleEmptinessEventHandler: function _toggleEmptinessEventHandler() {\n    this._toggleEmptiness(!this._getValue().length && !this._searchValue().length);\n  },\n  _customItemAddedHandler: function _customItemAddedHandler(e) {\n    this.callBase(e);\n\n    this._clearTextValue();\n  },\n  _removeTagHandler: function _removeTagHandler(args) {\n    var e = args.event;\n    e.stopPropagation();\n\n    this._saveValueChangeEvent(e);\n\n    var $tag = $(e.target).closest(\".\".concat(TAGBOX_TAG_CLASS));\n\n    this._removeTagElement($tag);\n  },\n  _removeTagElement: function _removeTagElement($tag) {\n    if ($tag.hasClass(TAGBOX_MULTI_TAG_CLASS)) {\n      if (!this.option(\"showMultiTagOnly\")) {\n        this.option(\"value\", this._getValue().slice(0, this.option(\"maxDisplayedTags\")));\n      } else {\n        this.reset();\n      }\n\n      return;\n    }\n\n    var itemValue = $tag.data(TAGBOX_TAG_DATA_KEY);\n\n    this._removeTagWithUpdate(itemValue);\n\n    this._refreshTagElements();\n  },\n  _updateField: noop,\n  _removeTagWithUpdate: function _removeTagWithUpdate(itemValue) {\n    var value = this._getValue().slice();\n\n    this._removeTag(value, itemValue);\n\n    this.option(\"value\", value);\n\n    if (0 === value.length) {\n      this._clearTagFocus();\n    }\n  },\n  _getCurrentValue: function _getCurrentValue() {\n    return this._lastValue();\n  },\n  _selectionChangeHandler: function _selectionChangeHandler(e) {\n    var _this15 = this;\n\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      return;\n    }\n\n    var value = this._getValue().slice();\n\n    each(e.removedItems || [], function (_, removedItem) {\n      _this15._removeTag(value, _this15._valueGetter(removedItem));\n    });\n    each(e.addedItems || [], function (_, addedItem) {\n      _this15._addTag(value, _this15._valueGetter(addedItem));\n    });\n\n    this._updateWidgetHeight();\n\n    if (!equalByValue(this._list.option(\"selectedItemKeys\"), this.option(\"value\"))) {\n      var listSelectionChangeEvent = this._list._getSelectionChangeEvent();\n\n      listSelectionChangeEvent && this._saveValueChangeEvent(listSelectionChangeEvent);\n      this.option(\"value\", value);\n    }\n\n    this._list._saveSelectionChangeEvent(void 0);\n  },\n  _removeTag: function _removeTag(value, item) {\n    var index = this._valueIndex(item, value);\n\n    if (index >= 0) {\n      value.splice(index, 1);\n    }\n  },\n  _addTag: function _addTag(value, item) {\n    var index = this._valueIndex(item);\n\n    if (index < 0) {\n      value.push(item);\n    }\n  },\n  _fieldRenderData: function _fieldRenderData() {\n    return this._selectedItems.slice();\n  },\n  _completeSelection: function _completeSelection(value) {\n    if (!this.option(\"showSelectionControls\")) {\n      this._setValue(value);\n    }\n  },\n  _setValue: function _setValue(value) {\n    if (null === value) {\n      return;\n    }\n\n    var useButtons = \"useButtons\" === this.option(\"applyValueMode\");\n\n    var valueIndex = this._valueIndex(value);\n\n    var values = (useButtons ? this._list.option(\"selectedItemKeys\") : this._getValue()).slice();\n\n    if (valueIndex >= 0) {\n      values.splice(valueIndex, 1);\n    } else {\n      values.push(value);\n    }\n\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      this._list.option(\"selectedItemKeys\", values);\n    } else {\n      this.option(\"value\", values);\n    }\n  },\n  _isSelectedValue: function _isSelectedValue(value, cache) {\n    return this._valueIndex(value, null, cache) > -1;\n  },\n  _valueIndex: function _valueIndex(value, values, cache) {\n    var _this16 = this;\n\n    var result = -1;\n\n    if (cache && \"object\" !== typeof value) {\n      if (!cache.indexByValues) {\n        cache.indexByValues = {};\n        values = values || this._getValue();\n        values.forEach(function (value, index) {\n          cache.indexByValues[value] = index;\n        });\n      }\n\n      if (value in cache.indexByValues) {\n        return cache.indexByValues[value];\n      }\n    }\n\n    values = values || this._getValue();\n    each(values, function (index, selectedValue) {\n      if (_this16._isValueEquals(value, selectedValue)) {\n        result = index;\n        return false;\n      }\n    });\n    return result;\n  },\n  _lastValue: function _lastValue() {\n    var values = this._getValue();\n\n    var lastValue = values[values.length - 1];\n    return null !== lastValue && void 0 !== lastValue ? lastValue : null;\n  },\n  _valueChangeEventHandler: noop,\n  _shouldRenderSearchEvent: function _shouldRenderSearchEvent() {\n    return this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\n  },\n  _searchHandler: function _searchHandler(e) {\n    if (this.option(\"searchEnabled\") && !!e && !this._isTagRemoved) {\n      this.callBase(arguments);\n\n      this._setListDataSourceFilter();\n    }\n\n    this._updateWidgetHeight();\n\n    delete this._isTagRemoved;\n  },\n  _updateWidgetHeight: function _updateWidgetHeight() {\n    var element = this.$element();\n    var originalHeight = getHeight(element);\n\n    this._renderInputSize();\n\n    var currentHeight = getHeight(element);\n\n    if (this._popup && this.option(\"opened\") && this._isEditable() && currentHeight !== originalHeight) {\n      this._popup.repaint();\n    }\n  },\n  _refreshSelected: function _refreshSelected() {\n    var _this$_list3;\n\n    (null === (_this$_list3 = this._list) || void 0 === _this$_list3 ? void 0 : _this$_list3.getDataSource()) && this._list.option(\"selectedItems\", this._selectedItems);\n  },\n  _resetListDataSourceFilter: function _resetListDataSourceFilter() {\n    var dataSource = this._getDataSource();\n\n    if (!dataSource) {\n      return;\n    }\n\n    delete this._userFilter;\n    dataSource.filter(null);\n    dataSource.reload();\n  },\n  _setListDataSourceFilter: function _setListDataSourceFilter() {\n    if (!this.option(\"hideSelectedItems\") || !this._list) {\n      return;\n    }\n\n    var dataSource = this._getDataSource();\n\n    if (!dataSource) {\n      return;\n    }\n\n    var valueGetterExpr = this._valueGetterExpr();\n\n    if (isString(valueGetterExpr) && \"this\" !== valueGetterExpr) {\n      var filter = this._dataSourceFilterExpr();\n\n      if (void 0 === this._userFilter) {\n        this._userFilter = dataSource.filter() || null;\n      }\n\n      this._userFilter && filter.push(this._userFilter);\n      filter.length ? dataSource.filter(filter) : dataSource.filter(null);\n    } else {\n      dataSource.filter(this._dataSourceFilterFunction.bind(this));\n    }\n\n    dataSource.load();\n  },\n  _dataSourceFilterExpr: function _dataSourceFilterExpr() {\n    var _this17 = this;\n\n    var filter = [];\n    each(this._getValue(), function (index, value) {\n      filter.push([\"!\", [_this17._valueGetterExpr(), value]]);\n    });\n    return filter;\n  },\n  _dataSourceFilterFunction: function _dataSourceFilterFunction(itemData) {\n    var _this18 = this;\n\n    var itemValue = this._valueGetter(itemData);\n\n    var result = true;\n    each(this._getValue(), function (index, value) {\n      if (_this18._isValueEquals(value, itemValue)) {\n        result = false;\n        return false;\n      }\n    });\n    return result;\n  },\n  _dataSourceChangedHandler: function _dataSourceChangedHandler() {\n    this._isDataSourceChanged = true;\n    this.callBase.apply(this, arguments);\n  },\n  _applyButtonHandler: function _applyButtonHandler(args) {\n    this._saveValueChangeEvent(args.event);\n\n    this.option(\"value\", this._getSortedListValues());\n\n    this._clearTextValue();\n\n    this.callBase();\n\n    this._cancelSearchIfNeed();\n  },\n  _getSortedListValues: function _getSortedListValues() {\n    var listValues = this._getListValues();\n\n    var currentValue = this.option(\"value\") || [];\n    var existedItems = listValues.length ? currentValue.filter(function (item) {\n      return -1 !== listValues.indexOf(item);\n    }) : [];\n    var newItems = existedItems.length ? listValues.filter(function (item) {\n      return -1 === currentValue.indexOf(item);\n    }) : listValues;\n    return existedItems.concat(newItems);\n  },\n  _getListValues: function _getListValues() {\n    var _this19 = this;\n\n    if (!this._list) {\n      return [];\n    }\n\n    var selectedItems = this._getPlainItems(this._list.option(\"selectedItems\"));\n\n    var result = [];\n    each(selectedItems, function (index, item) {\n      result[index] = _this19._valueGetter(item);\n    });\n    return result;\n  },\n  _setListDataSource: function _setListDataSource() {\n    var currentValue = this._getValue();\n\n    this.callBase();\n\n    if (currentValue !== this.option(\"value\")) {\n      this.option(\"value\", currentValue);\n    }\n\n    this._refreshSelected();\n  },\n  _renderOpenedState: function _renderOpenedState() {\n    this.callBase();\n\n    if (\"useButtons\" === this.option(\"applyValueMode\") && !this.option(\"opened\")) {\n      this._refreshSelected();\n    }\n  },\n  reset: function reset() {\n    this._restoreInputText();\n\n    var defaultValue = this._getDefaultOptions().value;\n\n    var currentValue = this.option(\"value\");\n\n    if (defaultValue && 0 === defaultValue.length && currentValue && defaultValue.length === currentValue.length) {\n      return;\n    }\n\n    this.callBase();\n  },\n  _clean: function _clean() {\n    this.callBase();\n    delete this._defaultTagTemplate;\n    delete this._valuesToUpdate;\n    delete this._tagTemplate;\n  },\n  _removeDuplicates: function _removeDuplicates(from, what) {\n    var _this20 = this;\n\n    var result = [];\n    each(from, function (_, value) {\n      var filteredItems = what.filter(function (item) {\n        return _this20._valueGetter(value) === _this20._valueGetter(item);\n      });\n\n      if (!filteredItems.length) {\n        result.push(value);\n      }\n    });\n    return result;\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"onSelectAllValueChanged\":\n        this._initSelectAllValueChangedAction();\n\n        break;\n\n      case \"onMultiTagPreparing\":\n        this._initMultiTagPreparingAction();\n\n        this._renderTags();\n\n        break;\n\n      case \"hideSelectedItems\":\n        if (args.value) {\n          this._setListDataSourceFilter();\n        } else {\n          this._resetListDataSourceFilter();\n        }\n\n        break;\n\n      case \"useSubmitBehavior\":\n        this._toggleSubmitElement(args.value);\n\n        break;\n\n      case \"displayExpr\":\n        this.callBase(args);\n\n        this._initTemplates();\n\n        this._invalidate();\n\n        break;\n\n      case \"tagTemplate\":\n        this._initTagTemplate();\n\n        this._invalidate();\n\n        break;\n\n      case \"selectAllText\":\n        this._setListOption(\"selectAllText\", this.option(\"selectAllText\"));\n\n        break;\n\n      case \"readOnly\":\n      case \"disabled\":\n        this.callBase(args);\n        !args.value && this._refreshEvents();\n        break;\n\n      case \"value\":\n        this._valuesToUpdate = null === args || void 0 === args ? void 0 : args.value;\n        this.callBase(args);\n        this._valuesToUpdate = void 0;\n\n        this._setListDataSourceFilter();\n\n        break;\n\n      case \"maxDisplayedTags\":\n      case \"showMultiTagOnly\":\n        this._renderTags();\n\n        break;\n\n      case \"selectAllMode\":\n        this._setListOption(args.name, args.value);\n\n        break;\n\n      case \"selectedItem\":\n        break;\n\n      case \"selectedItems\":\n        this._selectionChangedAction({\n          addedItems: this._removeDuplicates(args.value, args.previousValue),\n          removedItems: this._removeDuplicates(args.previousValue, args.value)\n        });\n\n        break;\n\n      case \"multiline\":\n        this.$element().toggleClass(TAGBOX_SINGLE_LINE_CLASS, !args.value);\n\n        this._renderSingleLineScroll();\n\n        break;\n\n      case \"maxFilterQueryLength\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _getActualSearchValue: function _getActualSearchValue() {\n    return this.callBase() || this._searchValue();\n  },\n  _popupHidingHandler: function _popupHidingHandler() {\n    this.callBase();\n\n    this._clearFilter();\n  }\n});\nregisterComponent(\"dxTagBox\", TagBox);\nexport default TagBox;","map":null,"metadata":{},"sourceType":"module"}