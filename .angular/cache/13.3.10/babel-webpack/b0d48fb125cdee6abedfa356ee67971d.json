{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scroll_view/ui.scroll_view.js)\r\n * Version: 21.2.6\r\n * Build date: Tue Mar 01 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport devices from \"../../core/devices\";\nimport { hasWindow } from \"../../core/utils/window\";\nimport messageLocalization from \"../../localization/message\";\nimport registerComponent from \"../../core/component_registrator\";\nimport { getPublicElement } from \"../../core/element\";\nimport { extend } from \"../../core/utils/extend\";\nimport { noop } from \"../../core/utils/common\";\nimport PullDownStrategy from \"./ui.scroll_view.native.pull_down\";\nimport SwipeDownStrategy from \"./ui.scroll_view.native.swipe_down\";\nimport SimulatedStrategy from \"./ui.scroll_view.simulated\";\nimport Scrollable from \"./ui.scrollable\";\nimport LoadIndicator from \"../load_indicator\";\nimport { isMaterial } from \"./../themes\";\nimport LoadPanel from \"../load_panel\";\nvar SCROLLVIEW_CLASS = \"dx-scrollview\";\nvar SCROLLVIEW_CONTENT_CLASS = SCROLLVIEW_CLASS + \"-content\";\nvar SCROLLVIEW_TOP_POCKET_CLASS = SCROLLVIEW_CLASS + \"-top-pocket\";\nvar SCROLLVIEW_BOTTOM_POCKET_CLASS = SCROLLVIEW_CLASS + \"-bottom-pocket\";\nvar SCROLLVIEW_PULLDOWN_CLASS = SCROLLVIEW_CLASS + \"-pull-down\";\nvar SCROLLVIEW_REACHBOTTOM_CLASS = SCROLLVIEW_CLASS + \"-scrollbottom\";\nvar SCROLLVIEW_REACHBOTTOM_INDICATOR_CLASS = SCROLLVIEW_REACHBOTTOM_CLASS + \"-indicator\";\nvar SCROLLVIEW_REACHBOTTOM_TEXT_CLASS = SCROLLVIEW_REACHBOTTOM_CLASS + \"-text\";\nvar SCROLLVIEW_LOADPANEL = SCROLLVIEW_CLASS + \"-loadpanel\";\nvar refreshStrategies = {\n  pullDown: PullDownStrategy,\n  swipeDown: SwipeDownStrategy,\n  simulated: SimulatedStrategy\n};\nvar isServerSide = !hasWindow();\nvar scrollViewServerConfig = {\n  finishLoading: noop,\n  release: noop,\n  refresh: noop,\n  _optionChanged: function _optionChanged(args) {\n    if (\"onUpdated\" !== args.name) {\n      return this.callBase.apply(this, arguments);\n    }\n  }\n};\nvar ScrollView = Scrollable.inherit(isServerSide ? scrollViewServerConfig : {\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      pullingDownText: messageLocalization.format(\"dxScrollView-pullingDownText\"),\n      pulledDownText: messageLocalization.format(\"dxScrollView-pulledDownText\"),\n      refreshingText: messageLocalization.format(\"dxScrollView-refreshingText\"),\n      reachBottomText: messageLocalization.format(\"dxScrollView-reachBottomText\"),\n      onPullDown: null,\n      onReachBottom: null,\n      refreshStrategy: \"pullDown\"\n    });\n  },\n  _defaultOptionsRules: function _defaultOptionsRules() {\n    return this.callBase().concat([{\n      device: function device() {\n        var realDevice = devices.real();\n        return \"android\" === realDevice.platform;\n      },\n      options: {\n        refreshStrategy: \"swipeDown\"\n      }\n    }, {\n      device: function device() {\n        return isMaterial();\n      },\n      options: {\n        pullingDownText: \"\",\n        pulledDownText: \"\",\n        refreshingText: \"\",\n        reachBottomText: \"\"\n      }\n    }]);\n  },\n  _init: function _init() {\n    this.callBase();\n    this._loadingIndicatorEnabled = true;\n  },\n  _initScrollableMarkup: function _initScrollableMarkup() {\n    this.callBase();\n    this.$element().addClass(SCROLLVIEW_CLASS);\n\n    this._initContent();\n\n    this._initTopPocket();\n\n    this._initBottomPocket();\n\n    this._initLoadPanel();\n  },\n  _initContent: function _initContent() {\n    var $content = $(\"<div>\").addClass(SCROLLVIEW_CONTENT_CLASS);\n\n    this._$content.wrapInner($content);\n  },\n  _initTopPocket: function _initTopPocket() {\n    var $topPocket = this._$topPocket = $(\"<div>\").addClass(SCROLLVIEW_TOP_POCKET_CLASS);\n    var $pullDown = this._$pullDown = $(\"<div>\").addClass(SCROLLVIEW_PULLDOWN_CLASS);\n    $topPocket.append($pullDown);\n\n    this._$content.prepend($topPocket);\n  },\n  _initBottomPocket: function _initBottomPocket() {\n    var $bottomPocket = this._$bottomPocket = $(\"<div>\").addClass(SCROLLVIEW_BOTTOM_POCKET_CLASS);\n    var $reachBottom = this._$reachBottom = $(\"<div>\").addClass(SCROLLVIEW_REACHBOTTOM_CLASS);\n    var $loadContainer = $(\"<div>\").addClass(SCROLLVIEW_REACHBOTTOM_INDICATOR_CLASS);\n    var $loadIndicator = new LoadIndicator($(\"<div>\")).$element();\n    var $text = this._$reachBottomText = $(\"<div>\").addClass(SCROLLVIEW_REACHBOTTOM_TEXT_CLASS);\n\n    this._updateReachBottomText();\n\n    $reachBottom.append($loadContainer.append($loadIndicator)).append($text);\n    $bottomPocket.append($reachBottom);\n\n    this._$content.append($bottomPocket);\n  },\n  _initLoadPanel: function _initLoadPanel() {\n    var $loadPanelElement = $(\"<div>\").addClass(SCROLLVIEW_LOADPANEL).appendTo(this.$element());\n    var loadPanelOptions = {\n      shading: false,\n      delay: 400,\n      message: this.option(\"refreshingText\"),\n      position: {\n        of: this.$element()\n      }\n    };\n    this._loadPanel = this._createComponent($loadPanelElement, LoadPanel, loadPanelOptions);\n  },\n  _updateReachBottomText: function _updateReachBottomText() {\n    this._$reachBottomText.text(this.option(\"reachBottomText\"));\n  },\n  _createStrategy: function _createStrategy() {\n    var strategyName = this.option(\"useNative\") ? this.option(\"refreshStrategy\") : \"simulated\";\n    var strategyClass = refreshStrategies[strategyName];\n    this._strategy = new strategyClass(this);\n\n    this._strategy.pullDownCallbacks.add(this._pullDownHandler.bind(this));\n\n    this._strategy.releaseCallbacks.add(this._releaseHandler.bind(this));\n\n    this._strategy.reachBottomCallbacks.add(this._reachBottomHandler.bind(this));\n  },\n  _createActions: function _createActions() {\n    this.callBase();\n    this._pullDownAction = this._createActionByOption(\"onPullDown\");\n    this._reachBottomAction = this._createActionByOption(\"onReachBottom\");\n\n    this._tryRefreshPocketState();\n  },\n  _tryRefreshPocketState: function _tryRefreshPocketState() {\n    this._pullDownEnable(this.hasActionSubscription(\"onPullDown\"));\n\n    this._reachBottomEnable(this.hasActionSubscription(\"onReachBottom\"));\n  },\n  on: function on(eventName) {\n    var result = this.callBase.apply(this, arguments);\n\n    if (\"pullDown\" === eventName || \"reachBottom\" === eventName) {\n      this._tryRefreshPocketState();\n    }\n\n    return result;\n  },\n  _pullDownEnable: function _pullDownEnable(enabled) {\n    if (0 === arguments.length) {\n      return this._pullDownEnabled;\n    }\n\n    if (this._$pullDown && this._strategy) {\n      this._$pullDown.toggle(enabled);\n\n      this._strategy.pullDownEnable(enabled);\n\n      this._pullDownEnabled = enabled;\n    }\n  },\n  _reachBottomEnable: function _reachBottomEnable(enabled) {\n    if (0 === arguments.length) {\n      return this._reachBottomEnabled;\n    }\n\n    if (this._$reachBottom && this._strategy) {\n      this._$reachBottom.toggle(enabled);\n\n      this._strategy.reachBottomEnable(enabled);\n\n      this._reachBottomEnabled = enabled;\n    }\n  },\n  _pullDownHandler: function _pullDownHandler() {\n    this._loadingIndicator(false);\n\n    this._pullDownLoading();\n  },\n  _loadingIndicator: function _loadingIndicator(value) {\n    if (arguments.length < 1) {\n      return this._loadingIndicatorEnabled;\n    }\n\n    this._loadingIndicatorEnabled = value;\n  },\n  _pullDownLoading: function _pullDownLoading() {\n    this.startLoading();\n\n    this._pullDownAction();\n  },\n  _reachBottomHandler: function _reachBottomHandler() {\n    this._loadingIndicator(false);\n\n    this._reachBottomLoading();\n  },\n  _reachBottomLoading: function _reachBottomLoading() {\n    this.startLoading();\n\n    this._reachBottomAction();\n  },\n  _releaseHandler: function _releaseHandler() {\n    this.finishLoading();\n\n    this._loadingIndicator(true);\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"onPullDown\":\n      case \"onReachBottom\":\n        this._createActions();\n\n        break;\n\n      case \"pullingDownText\":\n      case \"pulledDownText\":\n      case \"refreshingText\":\n      case \"refreshStrategy\":\n        this._invalidate();\n\n        break;\n\n      case \"reachBottomText\":\n        this._updateReachBottomText();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  content: function content() {\n    return getPublicElement(this._$content.children().eq(1));\n  },\n  release: function release(preventReachBottom) {\n    if (void 0 !== preventReachBottom) {\n      this.toggleLoading(!preventReachBottom);\n    }\n\n    return this._strategy.release();\n  },\n  toggleLoading: function toggleLoading(showOrHide) {\n    this._reachBottomEnable(showOrHide);\n  },\n  refresh: function refresh() {\n    if (!this.hasActionSubscription(\"onPullDown\")) {\n      return;\n    }\n\n    this._strategy.pendingRelease();\n\n    this._pullDownLoading();\n  },\n  startLoading: function startLoading() {\n    if (this._loadingIndicator() && this.$element().is(\":visible\")) {\n      this._loadPanel.show();\n    }\n\n    this._lock();\n  },\n  finishLoading: function finishLoading() {\n    this._loadPanel.hide();\n\n    this._unlock();\n  },\n  _dispose: function _dispose() {\n    this._strategy.dispose();\n\n    this.callBase();\n\n    if (this._loadPanel) {\n      this._loadPanel.$element().remove();\n    }\n  }\n});\nregisterComponent(\"dxScrollView\", ScrollView);\nexport default ScrollView;","map":null,"metadata":{},"sourceType":"module"}