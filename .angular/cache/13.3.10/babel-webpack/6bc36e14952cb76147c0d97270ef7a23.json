{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.grid_view.js)\r\n * Version: 21.2.6\r\n * Build date: Tue Mar 01 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getOuterWidth, getInnerWidth, getWidth, getHeight, setHeight } from \"../../core/utils/size\";\nimport $ from \"../../core/renderer\";\nimport modules from \"./ui.grid_core.modules\";\nimport { deferRender, deferUpdate } from \"../../core/utils/common\";\nimport { hasWindow, getWindow } from \"../../core/utils/window\";\nimport { each } from \"../../core/utils/iterator\";\nimport { isString, isDefined, isNumeric } from \"../../core/utils/type\";\nimport { getBoundingRect } from \"../../core/utils/position\";\nimport gridCoreUtils from \"./ui.grid_core.utils\";\nimport messageLocalization from \"../../localization/message\";\nimport { when, Deferred } from \"../../core/utils/deferred\";\nimport domAdapter from \"../../core/dom_adapter\";\nimport * as accessibility from \"../shared/accessibility\";\nimport browser from \"../../core/utils/browser\";\nvar BORDERS_CLASS = \"borders\";\nvar TABLE_FIXED_CLASS = \"table-fixed\";\nvar IMPORTANT_MARGIN_CLASS = \"important-margin\";\nvar GRIDBASE_CONTAINER_CLASS = \"dx-gridbase-container\";\nvar HIDDEN_COLUMNS_WIDTH = \"adaptiveHidden\";\nvar VIEW_NAMES = [\"columnsSeparatorView\", \"blockSeparatorView\", \"trackerView\", \"headerPanel\", \"columnHeadersView\", \"rowsView\", \"footerView\", \"columnChooserView\", \"filterPanelView\", \"pagerView\", \"draggingHeaderView\", \"contextMenuView\", \"errorView\", \"headerFilterView\", \"filterBuilderView\"];\n\nvar isPercentWidth = function isPercentWidth(width) {\n  return isString(width) && \"%\" === width.slice(-1);\n};\n\nvar isPixelWidth = function isPixelWidth(width) {\n  return isString(width) && \"px\" === width.slice(-2);\n};\n\nvar getContainerHeight = function getContainerHeight($container) {\n  var clientHeight = $container.get(0).clientHeight;\n  var paddingTop = parseFloat($container.css(\"paddingTop\"));\n  var paddingBottom = parseFloat($container.css(\"paddingBottom\"));\n  return clientHeight - paddingTop - paddingBottom;\n};\n\nvar calculateFreeWidth = function calculateFreeWidth(that, widths) {\n  var contentWidth = that._rowsView.contentWidth();\n\n  var totalWidth = that._getTotalWidth(widths, contentWidth);\n\n  return contentWidth - totalWidth;\n};\n\nvar calculateFreeWidthWithCurrentMinWidth = function calculateFreeWidthWithCurrentMinWidth(that, columnIndex, currentMinWidth, widths) {\n  return calculateFreeWidth(that, widths.map(function (width, index) {\n    return index === columnIndex ? currentMinWidth : width;\n  }));\n};\n\nvar restoreFocus = function restoreFocus(focusedElement, selectionRange) {\n  accessibility.hiddenFocus(focusedElement);\n  gridCoreUtils.setSelectionRange(focusedElement, selectionRange);\n};\n\nvar ResizingController = modules.ViewController.inherit({\n  _initPostRenderHandlers: function _initPostRenderHandlers() {\n    var _this = this;\n\n    var dataController = this._dataController;\n\n    if (!this._refreshSizesHandler) {\n      this._refreshSizesHandler = function (e) {\n        dataController.changed.remove(_this._refreshSizesHandler);\n        var templateDeferreds = e && e.templateDeferreds || [];\n        when.apply(_this, templateDeferreds).done(function () {\n          _this._refreshSizes(e);\n        });\n      };\n\n      dataController.changed.add(function () {\n        dataController.changed.add(_this._refreshSizesHandler);\n      });\n    }\n  },\n  _refreshSizes: function _refreshSizes(e) {\n    var resizeDeferred;\n    var that = this;\n    var changeType = e && e.changeType;\n    var isDelayed = e && e.isDelayed;\n\n    var items = that._dataController.items();\n\n    if (!e || \"refresh\" === changeType || \"prepend\" === changeType || \"append\" === changeType) {\n      if (!isDelayed) {\n        resizeDeferred = that.resize();\n      }\n    } else if (\"update\" === changeType) {\n      var _e$changeTypes;\n\n      if (0 === (null === (_e$changeTypes = e.changeTypes) || void 0 === _e$changeTypes ? void 0 : _e$changeTypes.length)) {\n        return;\n      }\n\n      if ((items.length > 1 || \"insert\" !== e.changeTypes[0]) && !(0 === items.length && \"remove\" === e.changeTypes[0]) && !e.needUpdateDimensions) {\n        deferUpdate(function () {\n          return deferRender(function () {\n            return deferUpdate(function () {\n              that._setScrollerSpacing(that._hasHeight);\n\n              that._rowsView.resize();\n            });\n          });\n        });\n      } else {\n        resizeDeferred = that.resize();\n      }\n    }\n\n    if (changeType && \"updateSelection\" !== changeType && \"updateFocusedRow\" !== changeType && \"pageIndex\" !== changeType && !isDelayed) {\n      when(resizeDeferred).done(function () {\n        that._setAriaRowColCount();\n\n        that.fireContentReadyAction();\n      });\n    }\n  },\n  fireContentReadyAction: function fireContentReadyAction() {\n    this.component._fireContentReadyAction();\n  },\n  _setAriaRowColCount: function _setAriaRowColCount() {\n    var component = this.component;\n    component.setAria({\n      rowCount: this._dataController.totalItemsCount(),\n      colCount: component.columnCount()\n    }, component.$element().children(\".\" + GRIDBASE_CONTAINER_CLASS));\n  },\n  _getBestFitWidths: function _getBestFitWidths() {\n    var _widths;\n\n    var rowsView = this._rowsView;\n    var columnHeadersView = this._columnHeadersView;\n    var widths = rowsView.getColumnWidths();\n\n    if (!(null !== (_widths = widths) && void 0 !== _widths && _widths.length)) {\n      var _rowsView$getTableEle;\n\n      var headersTableElement = columnHeadersView.getTableElement();\n      columnHeadersView.setTableElement(null === (_rowsView$getTableEle = rowsView.getTableElement()) || void 0 === _rowsView$getTableEle ? void 0 : _rowsView$getTableEle.children(\".dx-header\"));\n      widths = columnHeadersView.getColumnWidths();\n      columnHeadersView.setTableElement(headersTableElement);\n    }\n\n    return widths;\n  },\n  _setVisibleWidths: function _setVisibleWidths(visibleColumns, widths) {\n    var columnsController = this._columnsController;\n    columnsController.beginUpdate();\n    each(visibleColumns, function (index, column) {\n      var columnId = columnsController.getColumnId(column);\n      columnsController.columnOption(columnId, \"visibleWidth\", widths[index]);\n    });\n    columnsController.endUpdate();\n  },\n  _toggleBestFitModeForView: function _toggleBestFitModeForView(view, className, isBestFit) {\n    var _this2 = this;\n\n    if (!view || !view.isVisible()) {\n      return;\n    }\n\n    var $rowsTables = this._rowsView.getTableElements();\n\n    var $viewTables = view.getTableElements();\n    each($rowsTables, function (index, tableElement) {\n      var $tableBody;\n      var $rowsTable = $(tableElement);\n      var $viewTable = $viewTables.eq(index);\n\n      if ($viewTable && $viewTable.length) {\n        if (isBestFit) {\n          $tableBody = $viewTable.children(\"tbody\").appendTo($rowsTable);\n        } else {\n          $tableBody = $rowsTable.children(\".\" + className).appendTo($viewTable);\n        }\n\n        $tableBody.toggleClass(className, isBestFit);\n        $tableBody.toggleClass(_this2.addWidgetPrefix(\"best-fit\"), isBestFit);\n      }\n    });\n  },\n  _toggleBestFitMode: function _toggleBestFitMode(isBestFit) {\n    var $rowsTable = this._rowsView.getTableElement();\n\n    var $rowsFixedTable = this._rowsView.getTableElements().eq(1);\n\n    if (!$rowsTable) {\n      return;\n    }\n\n    $rowsTable.css(\"tableLayout\", isBestFit ? \"auto\" : \"fixed\");\n    $rowsTable.children(\"colgroup\").css(\"display\", isBestFit ? \"none\" : \"\");\n    $rowsFixedTable.toggleClass(this.addWidgetPrefix(TABLE_FIXED_CLASS), !isBestFit);\n\n    this._toggleBestFitModeForView(this._columnHeadersView, \"dx-header\", isBestFit);\n\n    this._toggleBestFitModeForView(this._footerView, \"dx-footer\", isBestFit);\n\n    this._toggleContentMinHeight(isBestFit);\n\n    if (this._needStretch()) {\n      $rowsTable.get(0).style.width = isBestFit ? \"auto\" : \"\";\n    }\n  },\n  _toggleContentMinHeight: function _toggleContentMinHeight(isBestFit) {\n    if (this.option(\"wordWrapEnabled\")) {\n      var scrollable = this._rowsView.getScrollable();\n\n      var $contentElement = this._rowsView._findContentElement();\n\n      if (false === (null === scrollable || void 0 === scrollable ? void 0 : scrollable.option(\"useNative\"))) {\n        $contentElement.css({\n          minHeight: isBestFit ? gridCoreUtils.getContentHeightLimit(browser) : \"\"\n        });\n      }\n    }\n  },\n  _synchronizeColumns: function _synchronizeColumns() {\n    var _this3 = this;\n\n    var columnsController = this._columnsController;\n    var visibleColumns = columnsController.getVisibleColumns();\n    var columnAutoWidth = this.option(\"columnAutoWidth\");\n\n    var needBestFit = this._needBestFit();\n\n    var hasMinWidth = false;\n    var resetBestFitMode;\n    var isColumnWidthsCorrected = false;\n    var resultWidths = [];\n    var focusedElement;\n    var selectionRange;\n    !needBestFit && each(visibleColumns, function (index, column) {\n      if (\"auto\" === column.width) {\n        needBestFit = true;\n        return false;\n      }\n    });\n    each(visibleColumns, function (index, column) {\n      if (column.minWidth) {\n        hasMinWidth = true;\n        return false;\n      }\n    });\n\n    this._setVisibleWidths(visibleColumns, []);\n\n    if (needBestFit) {\n      focusedElement = domAdapter.getActiveElement();\n      selectionRange = gridCoreUtils.getSelectionRange(focusedElement);\n\n      this._toggleBestFitMode(true);\n\n      resetBestFitMode = true;\n    }\n\n    var $element = this.component.$element();\n\n    if ($element && $element[0] && this._maxWidth) {\n      delete this._maxWidth;\n      $element[0].style.maxWidth = \"\";\n    }\n\n    deferUpdate(function () {\n      if (needBestFit) {\n        resultWidths = _this3._getBestFitWidths();\n        each(visibleColumns, function (index, column) {\n          var columnId = columnsController.getColumnId(column);\n          columnsController.columnOption(columnId, \"bestFitWidth\", resultWidths[index], true);\n        });\n      } else if (hasMinWidth) {\n        resultWidths = _this3._getBestFitWidths();\n      }\n\n      each(visibleColumns, function (index) {\n        var width = this.width;\n\n        if (\"auto\" !== width) {\n          if (isDefined(width)) {\n            resultWidths[index] = isNumeric(width) || isPixelWidth(width) ? parseFloat(width) : width;\n          } else if (!columnAutoWidth) {\n            resultWidths[index] = void 0;\n          }\n        }\n      });\n\n      if (resetBestFitMode) {\n        _this3._toggleBestFitMode(false);\n\n        resetBestFitMode = false;\n\n        if (focusedElement && focusedElement !== domAdapter.getActiveElement()) {\n          var isFocusOutsideWindow = getBoundingRect(focusedElement).bottom < 0;\n\n          if (!isFocusOutsideWindow) {\n            restoreFocus(focusedElement, selectionRange);\n          }\n        }\n      }\n\n      isColumnWidthsCorrected = _this3._correctColumnWidths(resultWidths, visibleColumns);\n\n      if (columnAutoWidth) {\n        !function () {\n          var expandColumnWidth;\n          each(visibleColumns, function (index, column) {\n            if (\"groupExpand\" === column.type) {\n              expandColumnWidth = resultWidths[index];\n            }\n          });\n          each(visibleColumns, function (index, column) {\n            if (\"groupExpand\" === column.type && expandColumnWidth) {\n              resultWidths[index] = expandColumnWidth;\n            }\n          });\n        }();\n\n        if (_this3._needStretch()) {\n          _this3._processStretch(resultWidths, visibleColumns);\n        }\n      }\n\n      deferRender(function () {\n        if (needBestFit || isColumnWidthsCorrected) {\n          _this3._setVisibleWidths(visibleColumns, resultWidths);\n        }\n      });\n    });\n  },\n  _needBestFit: function _needBestFit() {\n    return this.option(\"columnAutoWidth\");\n  },\n  _needStretch: function _needStretch() {\n    return this._columnsController.getVisibleColumns().some(function (c) {\n      return \"auto\" === c.width && !c.command;\n    });\n  },\n  _getAverageColumnsWidth: function _getAverageColumnsWidth(resultWidths) {\n    var freeWidth = calculateFreeWidth(this, resultWidths);\n    var columnCountWithoutWidth = resultWidths.filter(function (width) {\n      return void 0 === width;\n    }).length;\n    return freeWidth / columnCountWithoutWidth;\n  },\n  _correctColumnWidths: function _correctColumnWidths(resultWidths, visibleColumns) {\n    var that = this;\n    var i;\n    var hasPercentWidth = false;\n    var hasAutoWidth = false;\n    var isColumnWidthsCorrected = false;\n    var $element = that.component.$element();\n    var hasWidth = that._hasWidth;\n\n    var _loop = function _loop() {\n      var index = i;\n      var column = visibleColumns[index];\n      var isHiddenColumn = resultWidths[index] === HIDDEN_COLUMNS_WIDTH;\n      var width = resultWidths[index];\n      var minWidth = column.minWidth;\n\n      if (minWidth) {\n        if (void 0 === width) {\n          var averageColumnsWidth = that._getAverageColumnsWidth(resultWidths);\n\n          width = averageColumnsWidth;\n        } else if (isPercentWidth(width)) {\n          var freeWidth = calculateFreeWidthWithCurrentMinWidth(that, index, minWidth, resultWidths);\n\n          if (freeWidth < 0) {\n            width = -1;\n          }\n        }\n      }\n\n      var realColumnWidth = that._getRealColumnWidth(index, resultWidths.map(function (columnWidth, columnIndex) {\n        return index === columnIndex ? width : columnWidth;\n      }));\n\n      if (minWidth && !isHiddenColumn && realColumnWidth < minWidth) {\n        resultWidths[index] = minWidth;\n        isColumnWidthsCorrected = true;\n        i = -1;\n      }\n\n      if (!isDefined(column.width)) {\n        hasAutoWidth = true;\n      }\n\n      if (isPercentWidth(column.width)) {\n        hasPercentWidth = true;\n      }\n    };\n\n    for (i = 0; i < visibleColumns.length; i++) {\n      _loop();\n    }\n\n    if (!hasAutoWidth && resultWidths.length) {\n      var $rowsViewElement = that._rowsView.element();\n\n      var contentWidth = that._rowsView.contentWidth();\n\n      var scrollbarWidth = that._rowsView.getScrollbarWidth();\n\n      var totalWidth = that._getTotalWidth(resultWidths, contentWidth);\n\n      if (totalWidth < contentWidth) {\n        var lastColumnIndex = gridCoreUtils.getLastResizableColumnIndex(visibleColumns, resultWidths);\n\n        if (lastColumnIndex >= 0) {\n          resultWidths[lastColumnIndex] = \"auto\";\n          isColumnWidthsCorrected = true;\n\n          if (false === hasWidth && !hasPercentWidth) {\n            var borderWidth = that.option(\"showBorders\") ? Math.ceil(getOuterWidth($rowsViewElement) - getInnerWidth($rowsViewElement)) : 0;\n            that._maxWidth = totalWidth + scrollbarWidth + borderWidth;\n            $element.css(\"maxWidth\", that._maxWidth);\n          }\n        }\n      }\n    }\n\n    return isColumnWidthsCorrected;\n  },\n  _processStretch: function _processStretch(resultSizes, visibleColumns) {\n    var groupSize = this._rowsView.contentWidth();\n\n    var tableSize = this._getTotalWidth(resultSizes, groupSize);\n\n    var unusedIndexes = {\n      length: 0\n    };\n\n    if (!resultSizes.length) {\n      return;\n    }\n\n    each(visibleColumns, function (index) {\n      if (this.width || resultSizes[index] === HIDDEN_COLUMNS_WIDTH) {\n        unusedIndexes[index] = true;\n        unusedIndexes.length++;\n      }\n    });\n    var diff = groupSize - tableSize;\n    var diffElement = Math.floor(diff / (resultSizes.length - unusedIndexes.length));\n    var onePixelElementsCount = diff - diffElement * (resultSizes.length - unusedIndexes.length);\n\n    if (diff >= 0) {\n      for (var i = 0; i < resultSizes.length; i++) {\n        if (unusedIndexes[i]) {\n          continue;\n        }\n\n        resultSizes[i] += diffElement;\n\n        if (onePixelElementsCount > 0) {\n          if (onePixelElementsCount < 1) {\n            resultSizes[i] += onePixelElementsCount;\n            onePixelElementsCount = 0;\n          } else {\n            resultSizes[i]++;\n            onePixelElementsCount--;\n          }\n        }\n      }\n    }\n  },\n  _getRealColumnWidth: function _getRealColumnWidth(columnIndex, columnWidths, groupWidth) {\n    var ratio = 1;\n    var width = columnWidths[columnIndex];\n\n    if (!isPercentWidth(width)) {\n      return parseFloat(width);\n    }\n\n    var percentTotalWidth = columnWidths.reduce(function (sum, width, index) {\n      if (!isPercentWidth(width)) {\n        return sum;\n      }\n\n      return sum + parseFloat(width);\n    }, 0);\n    var pixelTotalWidth = columnWidths.reduce(function (sum, width) {\n      if (!width || width === HIDDEN_COLUMNS_WIDTH || isPercentWidth(width)) {\n        return sum;\n      }\n\n      return sum + parseFloat(width);\n    }, 0);\n    groupWidth = groupWidth || this._rowsView.contentWidth();\n    var freeSpace = groupWidth - pixelTotalWidth;\n    var percentTotalWidthInPixel = percentTotalWidth * groupWidth / 100;\n\n    if (pixelTotalWidth > 0 && percentTotalWidthInPixel + pixelTotalWidth >= groupWidth) {\n      ratio = percentTotalWidthInPixel > freeSpace ? freeSpace / percentTotalWidthInPixel : 1;\n    }\n\n    return parseFloat(width) * groupWidth * ratio / 100;\n  },\n  _getTotalWidth: function _getTotalWidth(widths, groupWidth) {\n    var result = 0;\n\n    for (var i = 0; i < widths.length; i++) {\n      var width = widths[i];\n\n      if (width && width !== HIDDEN_COLUMNS_WIDTH) {\n        result += this._getRealColumnWidth(i, widths, groupWidth);\n      }\n    }\n\n    return Math.ceil(result);\n  },\n  updateSize: function updateSize(rootElement) {\n    var $groupElement;\n    var width;\n    var $rootElement = $(rootElement);\n    var importantMarginClass = this.addWidgetPrefix(IMPORTANT_MARGIN_CLASS);\n\n    if (void 0 === this._hasHeight && $rootElement && $rootElement.is(\":visible\") && getWidth($rootElement)) {\n      $groupElement = $rootElement.children(\".\" + this.getWidgetContainerClass());\n\n      if ($groupElement.length) {\n        $groupElement.detach();\n      }\n\n      this._hasHeight = !!getContainerHeight($rootElement);\n      width = getWidth($rootElement);\n      $rootElement.addClass(importantMarginClass);\n      this._hasWidth = getWidth($rootElement) === width;\n      $rootElement.removeClass(importantMarginClass);\n\n      if ($groupElement.length) {\n        $groupElement.appendTo($rootElement);\n      }\n    }\n  },\n  publicMethods: function publicMethods() {\n    return [\"resize\", \"updateDimensions\"];\n  },\n  resize: function resize() {\n    return !this.component._requireResize && this.updateDimensions();\n  },\n  updateDimensions: function updateDimensions(checkSize) {\n    var that = this;\n\n    that._initPostRenderHandlers();\n\n    if (!that._checkSize(checkSize)) {\n      return;\n    }\n\n    var prevResult = that._resizeDeferred;\n    var result = that._resizeDeferred = new Deferred();\n    when(prevResult).always(function () {\n      deferRender(function () {\n        if (that._dataController.isLoaded()) {\n          that._synchronizeColumns();\n        }\n\n        that._resetGroupElementHeight();\n\n        deferUpdate(function () {\n          deferRender(function () {\n            deferUpdate(function () {\n              that._updateDimensionsCore();\n            });\n          });\n        });\n      }).done(result.resolve).fail(result.reject);\n    });\n    return result.promise();\n  },\n  _resetGroupElementHeight: function _resetGroupElementHeight() {\n    var groupElement = this.component.$element().children().get(0);\n\n    var scrollable = this._rowsView.getScrollable();\n\n    if (groupElement && groupElement.style.height && (!scrollable || !scrollable.scrollTop())) {\n      groupElement.style.height = \"\";\n    }\n  },\n  _checkSize: function _checkSize(checkSize) {\n    var $rootElement = this.component.$element();\n\n    if (checkSize && (this._lastWidth === getWidth($rootElement) && this._lastHeight === getHeight($rootElement) && this._devicePixelRatio === getWindow().devicePixelRatio || !$rootElement.is(\":visible\"))) {\n      return false;\n    }\n\n    return true;\n  },\n  _setScrollerSpacingCore: function _setScrollerSpacingCore(hasHeight) {\n    var that = this;\n    var vScrollbarWidth = hasHeight ? that._rowsView.getScrollbarWidth() : 0;\n\n    var hScrollbarWidth = that._rowsView.getScrollbarWidth(true);\n\n    deferRender(function () {\n      that._columnHeadersView && that._columnHeadersView.setScrollerSpacing(vScrollbarWidth);\n      that._footerView && that._footerView.setScrollerSpacing(vScrollbarWidth);\n\n      that._rowsView.setScrollerSpacing(vScrollbarWidth, hScrollbarWidth);\n    });\n  },\n  _setScrollerSpacing: function _setScrollerSpacing(hasHeight) {\n    var _this4 = this;\n\n    if (true === this.option(\"scrolling.useNative\")) {\n      deferRender(function () {\n        deferUpdate(function () {\n          _this4._setScrollerSpacingCore(hasHeight);\n        });\n      });\n    } else {\n      this._setScrollerSpacingCore(hasHeight);\n    }\n  },\n  _updateDimensionsCore: function _updateDimensionsCore() {\n    var that = this;\n    var dataController = that._dataController;\n    var rowsView = that._rowsView;\n    var $rootElement = that.component.$element();\n    var groupElement = $rootElement.children().get(0);\n    var rootElementHeight = $rootElement && ($rootElement.get(0).clientHeight || getHeight($rootElement));\n    var maxHeight = parseInt($rootElement.css(\"maxHeight\"));\n    var maxHeightHappened = maxHeight && rootElementHeight >= maxHeight;\n    var height = that.option(\"height\") || $rootElement.get(0).style.height;\n    var editorFactory = that.getController(\"editorFactory\");\n    var isMaxHeightApplied = maxHeightHappened && groupElement.scrollHeight === groupElement.offsetHeight;\n    var $testDiv;\n    that.updateSize($rootElement);\n    var hasHeight = that._hasHeight || maxHeightHappened;\n\n    if (height && that._hasHeight ^ \"auto\" !== height) {\n      $testDiv = $(\"<div>\");\n      setHeight($testDiv, height);\n      $testDiv.appendTo($rootElement);\n      that._hasHeight = !!getHeight($testDiv);\n      $testDiv.remove();\n    }\n\n    deferRender(function () {\n      rowsView.height(null, hasHeight);\n\n      if (maxHeightHappened && !isMaxHeightApplied) {\n        $(groupElement).css(\"height\", maxHeight);\n      }\n\n      if (!dataController.isLoaded()) {\n        rowsView.setLoading(dataController.isLoading());\n        return;\n      }\n\n      deferUpdate(function () {\n        that._updateLastSizes($rootElement);\n\n        that._setScrollerSpacing(hasHeight);\n\n        each(VIEW_NAMES, function (index, viewName) {\n          var view = that.getView(viewName);\n\n          if (view) {\n            view.resize();\n          }\n        });\n        editorFactory && editorFactory.resize();\n      });\n    });\n  },\n  _updateLastSizes: function _updateLastSizes($rootElement) {\n    this._lastWidth = getWidth($rootElement);\n    this._lastHeight = getHeight($rootElement);\n    this._devicePixelRatio = getWindow().devicePixelRatio;\n  },\n  optionChanged: function optionChanged(args) {\n    switch (args.name) {\n      case \"width\":\n      case \"height\":\n        this.component._renderDimensions();\n\n        this.resize();\n\n      case \"renderAsync\":\n        args.handled = true;\n        return;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  init: function init() {\n    this._dataController = this.getController(\"data\");\n    this._columnsController = this.getController(\"columns\");\n    this._columnHeadersView = this.getView(\"columnHeadersView\");\n    this._footerView = this.getView(\"footerView\");\n    this._rowsView = this.getView(\"rowsView\");\n  }\n});\nvar SynchronizeScrollingController = modules.ViewController.inherit({\n  _scrollChangedHandler: function _scrollChangedHandler(views, pos, viewName) {\n    for (var j = 0; j < views.length; j++) {\n      if (views[j] && views[j].name !== viewName) {\n        views[j].scrollTo({\n          left: pos.left,\n          top: pos.top\n        });\n      }\n    }\n  },\n  init: function init() {\n    var views = [this.getView(\"columnHeadersView\"), this.getView(\"footerView\"), this.getView(\"rowsView\")];\n\n    for (var i = 0; i < views.length; i++) {\n      var view = views[i];\n\n      if (view) {\n        view.scrollChanged.add(this._scrollChangedHandler.bind(this, views));\n      }\n    }\n  }\n});\nvar GridView = modules.View.inherit({\n  _endUpdateCore: function _endUpdateCore() {\n    if (this.component._requireResize) {\n      this.component._requireResize = false;\n\n      this._resizingController.resize();\n    }\n  },\n  _getWidgetAriaLabel: function _getWidgetAriaLabel() {\n    return \"dxDataGrid-ariaDataGrid\";\n  },\n  init: function init() {\n    this._resizingController = this.getController(\"resizing\");\n    this._dataController = this.getController(\"data\");\n  },\n  getView: function getView(name) {\n    return this.component._views[name];\n  },\n  element: function element() {\n    return this._groupElement;\n  },\n  optionChanged: function optionChanged(args) {\n    if (isDefined(this._groupElement) && \"showBorders\" === args.name) {\n      this._groupElement.toggleClass(this.addWidgetPrefix(BORDERS_CLASS), !!args.value);\n\n      args.handled = true;\n    } else {\n      this.callBase(args);\n    }\n  },\n  _renderViews: function _renderViews($groupElement) {\n    var that = this;\n    each(VIEW_NAMES, function (index, viewName) {\n      var view = that.getView(viewName);\n\n      if (view) {\n        view.render($groupElement);\n      }\n    });\n  },\n  _getTableRoleName: function _getTableRoleName() {\n    return \"grid\";\n  },\n  render: function render($rootElement) {\n    var isFirstRender = !this._groupElement;\n    var $groupElement = this._groupElement || $(\"<div>\").addClass(this.getWidgetContainerClass());\n    $groupElement.addClass(GRIDBASE_CONTAINER_CLASS);\n    $groupElement.toggleClass(this.addWidgetPrefix(BORDERS_CLASS), !!this.option(\"showBorders\"));\n    this.setAria(\"role\", \"presentation\", $rootElement);\n    this.component.setAria({\n      role: this._getTableRoleName(),\n      label: messageLocalization.format(this._getWidgetAriaLabel())\n    }, $groupElement);\n    this._rootElement = $rootElement || this._rootElement;\n\n    if (isFirstRender) {\n      this._groupElement = $groupElement;\n      hasWindow() && this.getController(\"resizing\").updateSize($rootElement);\n      $groupElement.appendTo($rootElement);\n    }\n\n    this._renderViews($groupElement);\n  },\n  update: function update() {\n    var $rootElement = this._rootElement;\n    var $groupElement = this._groupElement;\n    var resizingController = this.getController(\"resizing\");\n\n    if ($rootElement && $groupElement) {\n      resizingController.resize();\n\n      if (this._dataController.isLoaded()) {\n        this._resizingController.fireContentReadyAction();\n      }\n    }\n  }\n});\nexport var gridViewModule = {\n  defaultOptions: function defaultOptions() {\n    return {\n      showBorders: false,\n      renderAsync: false\n    };\n  },\n  controllers: {\n    resizing: ResizingController,\n    synchronizeScrolling: SynchronizeScrollingController\n  },\n  views: {\n    gridView: GridView\n  },\n  VIEW_NAMES: VIEW_NAMES\n};","map":null,"metadata":{},"sourceType":"module"}